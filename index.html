<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>F.O.C.U.S - Multi-Fish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: {
                            50: '#f0f4ff',
                            100: '#e0e9ff',
                            200: '#c7d5ff',
                            300: '#a5b8ff',
                            400: '#7f90ff',
                            500: '#5f66ff',
                            600: '#4b3df5',
                            700: '#3c2fd8',
                            800: '#312aae',
                            900: '#2d2a89',
                        },
                        safety: {
                            green: '#10b981',
                            yellow: '#f59e0b',
                            orange: '#f97316',
                            red: '#ef4444',
                            blue: '#3b82f6'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .risk-low { background-color: #d1fae5; border-left: 4px solid #10b981; }
        .risk-medium { background-color: #fef3c7; border-left: 4px solid #f59e0b; }
        .risk-high { background-color: #fee2e2; border-left: 4px solid #ef4444; }
        .border-red-500 { border-color: #ef4444 !important; box-shadow: 0 0 0 1px #ef4444; }
        .fish-entry { border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; background-color: #f9fafb; position: relative; }
        .remove-fish-btn { position: absolute; top: 0.5rem; right: 0.5rem; background-color: #fee2e2; color: #ef4444; border: none; border-radius: 50%; width: 1.5rem; height: 1.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75rem; }
        .good-to-go { background-color: #d1fae5; color: #065f46; }
        .no-go { background-color: #fee2e2; color: #b91c1c; }
        .tool-highlight { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); border-color: #3b82f6; }
        .guide-section { margin-bottom: 2rem; padding: 1.5rem; background-color: #f8fafc; border-radius: 0.5rem; border-left: 4px solid #3b82f6; }
        .tool-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .tool-table th, .tool-table td { border: 1px solid #e5e7eb; padding: 0.75rem; text-align: left; }
        .tool-table th { background-color: #3b82f6; color: white; }
        .tool-table tr:nth-child(even) { background-color: #f9fafb; }
        .ai-thinking { background: linear-gradient(90deg, #f0f9ff, #e0f2fe, #f0f9ff); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .ai-analysis-panel { border-left: 4px solid #8b5cf6; background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); }
        .ai-recommendation { border-left: 4px solid #10b981; }
        .ai-warning { border-left: 4px solid #f59e0b; }
        .historical-data-item { border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; background-color: #f8fafc; cursor: pointer; transition: all 0.3s ease; }
        .historical-data-item:hover { background-color: #e0f2fe; border-color: #3b82f6; }
        .historical-data-item.selected { background-color: #dbeafe; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); }
        
        /* Additional styles for the new tabs */
        .tool-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .tool-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .bha-component {
            padding: 1rem;
            margin: 0.5rem 0;
            background: white;
            border-radius: 0.5rem;
            border-left: 4px solid #3b82f6;
            cursor: move;
        }
        .bha-preview {
            min-height: 400px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        .bha-assembly-area {
            min-height: 300px;
            position: relative;
        }
        .operation-step {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #10b981;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: #10b981;
            color: white;
            border-radius: 50%;
            margin-right: 1rem;
            font-weight: bold;
        }
        .fish-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        .fish-type-card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .fish-type-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.1);
        }
        .complexity-low { border-left-color: #10b981; }
        .complexity-medium { border-left-color: #f59e0b; }
        .complexity-high { border-left-color: #ef4444; }
        .complexity-critical { border-left-color: #7c3aed; }
        .guide-category {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .checklist-item:last-child {
            border-bottom: none;
        }
        .checklist-item input {
            margin-right: 1rem;
        }
        .progress-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        .progress-fill {
            height: 100%;
            background-color: #10b981;
            transition: width 0.3s ease;
        }
        .bha-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem 0;
        }
        .bha-part {
            width: 200px;
            padding: 0.75rem;
            text-align: center;
            background: white;
            border: 1px solid #cbd5e0;
            margin: 2px 0;
        }
        .bha-part.top { border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
        .bha-part.bottom { border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
        .bha-connector {
            width: 10px;
            height: 15px;
            background: #94a3b8;
        }
        
        /* Enhanced AI Styles */
        .ai-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .glow-border {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        .gradient-text {
            background: linear-gradient(90deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* HSSE Styles */
        .hsse-critical { background-color: #fee2e2; border-left: 6px solid #ef4444; }
        .hsse-high { background-color: #fef3c7; border-left: 6px solid #f59e0b; }
        .hsse-medium { background-color: #fef3c7; border-left: 6px solid #fbbf24; }
        .hsse-low { background-color: #d1fae5; border-left: 6px solid #10b981; }
        .hsse-rating {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.75rem;
        }
        .rating-critical { background-color: #dc2626; }
        .rating-high { background-color: #ea580c; }
        .rating-medium { background-color: #d97706; }
        .rating-low { background-color: #059669; }
        
        /* Historical Well Selection */
        .well-card {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .well-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        .well-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .well-status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-success { background-color: #d1fae5; color: #065f46; }
        .status-warning { background-color: #fef3c7; color: #92400e; }
        .status-danger { background-color: #fee2e2; color: #991b1b; }
        
        /* Save Button Styles */
        .save-well-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .save-well-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
        
        /* Logo Styles */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo-image {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }
        .logo-glow {
            filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.5));
        }
        .logo-rounded {
            border-radius: 12px;
        }
        .logo-circle {
            border-radius: 50%;
        }
        
        /* AI Fish Entry Styles */
        .ai-fish-entry {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .ai-fish-entry:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .ai-fish-entry.editing {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        .remove-ai-fish-btn {
            transition: all 0.2s ease;
        }
        .remove-ai-fish-btn:hover {
            transform: scale(1.1);
        }
        
        /* Fish Type Selector Animation */
        .fish-type-selector {
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fish-impact-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .impact-low {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .impact-medium {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .impact-high {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Fish type click area */
        .fish-type-clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .fish-type-clickable:hover {
            background-color: #e0f2fe;
            transform: scale(1.02);
        }
        
        /* Power BI Button Styles */
        .powerbi-btn {
            background: linear-gradient(135deg, #f2c811 0%, #d9a404 100%);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .powerbi-btn:hover {
            background: linear-gradient(135deg, #d9a404 0%, #b8860b 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(217, 164, 4, 0.3);
        }

        .powerbi-btn:active {
            transform: translateY(0);
        }

        .powerbi-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .powerbi-btn:hover::after {
            left: 100%;
        }

        .powerbi-badge {
            background: linear-gradient(135deg, #f2c811 0%, #d9a404 100%);
            color: white;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Login Page Content -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
            <h1 class="text-3xl font-bold text-center text-navy-900 mb-8 flex items-center justify-center gap-2">
                <div class="relative w-16 h-16 flex items-center justify-center">
                    <div class="absolute inset-0 bg-blue-500 rounded-full shadow-lg"></div>
                    <i class="fas fa-fish text-white text-3xl relative z-10"></i>
                    <div class="absolute inset-0 border-4 border-blue-600 rounded-full opacity-30"></div>
                </div>
            </h1>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-navy-500" placeholder="Enter username" required>
                </div>
                <div>
                    <label for="password" class="block text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-navy-500" placeholder="Enter password" required>
                </div>
                <div id="loginError" class="text-red-500 text-sm hidden">Invalid username or password</div>
                <button type="submit" class="w-full bg-navy-700 hover:bg-navy-800 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">Sign In</button>
                
                <!-- Power BI Button in Login Page -->
                <div class="mt-4 text-center">
                    <a href="https://app.powerbi.com/groups/me/reports/cdd3ebc3-e3b0-4bd4-b9fe-8599596c58fd/ReportSectionf452a3d89ad49282aa3e?experience=power-bi" 
                       target="_blank" 
                       class="powerbi-btn px-4 py-2 rounded-lg inline-flex items-center gap-2">
                        <i class="fas fa-chart-bar"></i>
                        Open Power BI Dashboard
                        <span class="powerbi-badge">NEW</span>
                    </a>
                    <p class="text-xs text-gray-500 mt-2">View comprehensive fishing analytics</p>
                </div>
            </form>
        </div>
    </div>

    <!-- Application Content -->
    <div id="appContent" class="hidden container mx-auto px-2 py-4 max-w-7xl">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden text-sm">
            <!-- Header -->
            <div class="bg-navy-900 text-white p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold"> F.O.C.U.S </h1>
                        <p class="mt-2 text-white">Fishing Optimization & Candidate Underpinning Strategy</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <!-- Power BI Button in Header -->
                        <a href="https://app.powerbi.com/groups/me/reports/cdd3ebc3-e3b0-4bd4-b9fe-8599596c58fd/ReportSectionf452a3d89ad49282aa3e?experience=power-bi" 
                           target="_blank" 
                           class="powerbi-btn px-4 py-2 rounded-lg flex items-center gap-2"
                           title="Open Power BI Dashboard">
                            <i class="fas fa-chart-bar"></i>
                            Power BI
                            <span class="powerbi-badge">LIVE</span>
                        </a>
                        
                        <div class="relative w-16 h-16 flex items-center justify-center">
                            <div class="absolute inset-0 bg-blue-500 rounded-full shadow-lg"></div>
                            <i class="fas fa-fish text-white text-3xl relative z-10"></i>
                            <div class="absolute inset-0 border-4 border-blue-600 rounded-full opacity-30"></div>
                        </div>
                        <button id="logoutBtn" class="text-white hover:text-gray-200 flex items-center gap-2" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="p-4">
                <!-- Tabs - Reordered as requested -->
                <div class="flex border-b border-navy-200 mb-4 overflow-x-auto">
                    <button class="tab-btn py-2 px-4 font-medium text-navy-900 border-b-2 border-navy-900" data-tab="calculator">Fill in Data</button>
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="economic">Fishing Operation Summary</button>
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="hsse">üõ°Ô∏è HSSE & Risk Assessment</button>
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="ai-analysis">
                        <img src="https://github.com/fadelgifari/CRSSC/releases/download/Alpha/Picture2.png" 
                             alt="JoRUN AI Logo" 
                             class="inline-block w-6 h-6 object-contain mr-2">
                        JoRUN AI
                    </button>
                    <!-- Power BI Tab -->
                    
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="selection-guide">Fishing Selection Guide</button>
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="bha-design">Fishing BHA Design</button>
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="fish-type-bha">BHA Based on Fish Type</button>
                    <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="operation-guidance">Fishing Operation Guidance</button>
                </div>

                <!-- Calculator Tab -->
                <div id="calculator" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Left Column -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold text-blue-800">Well Data</h2>
                                <button id="saveWellDataBtn" class="save-well-btn px-4 py-2 rounded-lg flex items-center gap-2 shadow-md">
                                    <i class="fas fa-save"></i>
                                    Save Well Data
                                </button>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Well Name</label>
                                <input type="text" id="wellName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter well name">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Is this First Entry? <span class="text-red-500">*</span></label>
                                <select id="firstEntry" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <option value="" selected disabled>Choose an Option</option>
                                    <option value="yes">YES</option>
                                    <option value="no">NO</option>
                                </select>
                            </div>
                            <!-- Fields that should only show when First Entry is "NO" -->
                            <div id="nonFirstEntryFields" class="hidden">
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Current Oil Production (BOPD) <span class="text-red-500">*</span></label>
                                    <input type="number" id="oilProduction" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please enter BOPD" required />
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Oil Price ($/bbl) <span class="text-red-500">*</span></label>
                                    <input type="number" id="oilPrice" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please enter Oil Price" required />
                                </div>  
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Previous Job Cost (USD)<span class="text-red-500">*</span></label>
                                    <input type="number" id="previousJobCost" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please enter previous job cost(If none enter 0)" required />
                                </div>
                            </div>
                            <!-- Show BOPD and Oil Price for First Entry as well -->
                            <div id="firstEntryEconomicFields" class="hidden">
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Current Oil Production (BOPD) <span class="text-red-500">*</span></label>
                                    <input type="number" id="oilProductionFirst" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please enter BOPD" required />
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Oil Price ($/bbl) <span class="text-red-500">*</span></label>
                                    <input type="number" id="oilPriceFirst" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please enter Oil Price" required />
                                </div>
                            </div>
                           <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Field Name</label>
                                <select id="fieldName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="MINAS" data-complexity-prob="0.096" data-complexity-success="0.9215" data-decline-rate="0.65" data-lifting-cost="20" data-rig-cost="6500">MINAS</option>
                                    <option value="PETKO" data-complexity-prob="0.0525" data-complexity-success="1" data-decline-rate="0.30" data-lifting-cost="20" data-rig-cost="7000">PETKO</option>
                                    <option value="LIBO" data-complexity-prob="0.0525" data-complexity-success="0.9215" data-decline-rate="0.30" data-lifting-cost="20" data-rig-cost="6500">LIBO</option>
                                    <option value="BALAM" data-complexity-prob="0.0525" data-complexity-success="0.9215" data-decline-rate="0.35" data-lifting-cost="20" data-rig-cost="6500">BALAM</option>
                                    <option value="BANGKO" data-complexity-prob="0.0525" data-complexity-success="0.9215" data-decline-rate="0.30" data-lifting-cost="20" data-rig-cost="6500">BANGKO</option>
                                    <option value="BEKASAP" data-complexity-prob="0.0525" data-complexity-success="0.9215" data-decline-rate="0.30" data-lifting-cost="20" data-rig-cost="6500">BEKASAP</option>
                                    <option value="DSF" data-complexity-prob="0.135" data-complexity-success="0.855" data-decline-rate="0.40" data-lifting-cost="15" data-rig-cost="6500">DSF</option>
                                </select>
                            </div>
                            <div class="mt-6 border-t pt-4">
                                <h2 class="text-xl font-semibold mb-4 text-blue-800">Wellbore Condition</h2>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Casing Parted/Collapse</label>
                                    <select id="casingPartedCollapse" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="1">No casing parted/collapse</option>
                                        <option value="0.2">Both tools & fish can pass (clay present)</option>
                                        <option value="0">Neither tools nor fish can pass</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Casing Damage</label>
                                    <select id="casingDamage" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="1">No casing damage</option>
                                        <option value="0.57">Both tools & fish can pass (clay present)</option>
                                        <option value="0">Neither tools nor fish can pass</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Completion Type</label>
                                    <select id="fishingType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0,8">Open Hole Fishing</option>
                                        <option value="1">Cased Hole Fishing</option>
                                    </select>
                                </div>
                                <div class="mb-4 hidden">
                                    <label class="block text-gray-700 mb-2">Well Geometry (for Fishing Potential - First Entry)</label>
                                    <select id="wellGeometry" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0.01">Less than 30¬∞</option>
                                        <option value="0.02">31¬∞ to 60¬∞</option>
                                        <option value="0.03">Greater than 60¬∞</option>
                                    </select>
                                </div>
                                <div class="mb-4 hidden">
                                    <label class="block text-gray-700 mb-2">Well Geometry (for Success Ratio - Not First Entry )</label>
                                    <select id="wellGeometrySuccess" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="1">Less than 30¬∞</option>
                                        <option value="0.95">31¬∞ to 60¬∞</option>
                                        <option value="0.9">Greater than 60¬∞</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Interest Depth Above Downhole Object</label>
                                    <select id="formationAbove" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0.09">Yes</option>
                                        <option value="0.015">No</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Period Downhole Object on the Well?</label>
                                    <select id="objectPeriod" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0.04">Less than 2 years</option>
                                        <option value="0.1">2 to 5 years</option>
                                        <option value="0.16">More than 5 years</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Downhole Object Using Safety Joint?</label>
                                    <select id="safetyJoint" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0.1">Yes</option>
                                        <option value="0.05">No</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Downhole Object Have Tail?</label>
                                    <select id="tailPresence" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0.0375">Have Tail <100ft</option>
                                        <option value="0.075">Have Tail >100ft</option>
                                        <option value="0.0125">Doesn't have tail</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Well Ex TPA (Temporary Plug Abandoned)</label>
                                    <select id="wellExTpa" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0.14">Yes</option>
                                        <option value="0.02">No</option>
                                    </select>
                                </div>
                                <!-- Fishing Conditions Section -->
                                <div id="fishingConditionsSection" class="mt-6 border-t pt-4">
                                    <h2 class="text-xl font-semibold mb-4 text-blue-800">Fish Conditions</h2>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 mb-2">TOF Information (Top of Fish)</label>
                                        <select id="tofCondition" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="1"> Ready for fishing</option>
                                            <option value="0.85">Needs 1 step prep</option>
                                            <option value="0.8">Needs more than 1 step prep</option>
                                        </select>
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 mb-2">Fish Detail Information</label>
                                        <select id="fishDetailCondition" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="1">Fish Data 100%</option>
                                            <option value="0.95">Fish Data 50%</option>
                                            <option value="0.85">Fish Data N/A</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold text-blue-800">Fish Entries</h2>
                                <button id="addFishBtn" class="bg-navy-700 hover:bg-navy-800 text-white px-4 py-2 rounded-lg flex items-center shadow-md transition-colors duration-200">
                                    <i class="fas fa-plus mr-2"></i> Add Fish
                                </button>
                            </div>
                            <div id="fishEntriesContainer">
                                <!-- Fish entries will be added here -->
                            </div>
                            <div class="mt-6 flex gap-4">
                                <button id="calculateBtn" class="flex-1 bg-navy-700 hover:bg-navy-800 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">
                                    Calculate All Fishing Parameters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Economic Analysis Tab -->
                <div id="economic" class="tab-content">
                    <h2 class="text-xl font-semibold mb-6 text-blue-800">Fishing Operation Summary</h2>
                    <div class="bg-white p-6 rounded-lg shadow mb-6">
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4" id="fishingTitle">Potential Fishing</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-4 border rounded-lg bg-blue-50">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium">Well Name:</span>
                                        <span id="wellNameResult" class="font-bold text-blue-800">--</span>
                                    </div>
                                </div>
                                <!-- First Entry Fields (shown when YES) -->
                                <div id="firstEntryFields" class="hidden">
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Fishing Potential</span>
                                            <span id="successRate" class="font-bold text-blue-800">--%</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Fishing Potential Cost (USD)</span>
                                            <span id="estimatedCost" class="font-bold text-blue-800">$0</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Fishing Potential Cycle time (Days)</span>
                                            <span id="cycleTime" class="font-bold text-blue-800">--</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">EFT (Economic Fishing Time)</span>
                                            <span id="economicFishingTimeFirst" class="font-bold text-blue-800">-- days</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg" id="costVsEftContainerFirst">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Recommendation</span>
                                            <span id="costVsEftFirst" class="font-bold">--</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Actual Fishing Fields (shown when NO) -->
                                <div id="actualFishingFields" class="hidden">
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Success Ratio</span>
                                            <span id="successPrediction" class="font-bold text-blue-800">--%</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Planned Fishing Cost (USD)</span>
                                            <span id="fishingCostEstimate" class="font-bold text-blue-800">$0</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Previous Job Cost (USD)</span>
                                            <span id="previousJobCostResult" class="font-bold text-blue-800">$0</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Planned Fishing time (Days)</span>
                                            <span id="fishingCycleTime" class="font-bold text-blue-800">-- days</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg bg-blue-50">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">EFT (Economic Fishing Time)</span>
                                            <span id="economicFishingTime" class="font-bold text-blue-800">-- days</span>
                                        </div>
                                    </div>
                                    <div class="p-4 border rounded-lg" id="costVsEftContainer">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">Recommendation</span>
                                            <span id="costVsEft" class="font-bold">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Recommended Fishing Tools Section -->
                        <div class="mt-8 bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-4 text-blue-800">Recommended Fishing Tools</h3>
                            <div class="flex flex-col md:flex-row gap-6">
                                <!-- Static BHA Assembly Image -->
                                <div class="w-full md:w-1/3 bg-gray-50 p-4 rounded-lg border">
                                    <div class="text-center">
                                        <h4 class="font-medium mb-2">BHA Assembly</h4>
                                        <img src="https://github.com/fadelgifari/focus/releases/download/Alpha/BHA.png" alt="BHA Assembly Diagram" class="w-full h-auto object-contain mx-auto">
                                        <p class="text-sm text-gray-600 mt-2">Top section of standard fishing BHA</p>
                                    </div>
                                </div>
                                <!-- Dynamic Tool Recommendations -->
                                <div class="w-full md:w-2/3">
                                    <div id="bhaRecommendation" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <!-- Tools will be dynamically inserted here -->
                                    </div>
                                    <div id="toolRecommendationNotes" class="mt-4 p-4 bg-yellow-50 rounded-lg text-sm hidden">
                                        <!-- Recommendation notes will appear here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HSSE & Risk Assessment Tab -->
                <div id="hsse" class="tab-content">
                    <h2 class="text-xl font-semibold mb-6 text-blue-800">üõ°Ô∏è HSSE & Risk Assessment</h2>
                    
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6 border-2 border-green-300">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="relative">
                                <div class="absolute inset-0 bg-green-500 rounded-full animate-ping opacity-20"></div>
                                <i class="fas fa-shield-alt text-4xl text-green-600 relative z-10"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-green-800">HSSE DASHBOARD</h3>
                                <p class="text-sm text-green-600">Health, Safety, Security & Environmental Assessment</p>
                            </div>
                            <div class="ml-auto bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-lg font-bold">
                                <i class="fas fa-chart-line mr-2"></i>RISK MONITORING
                            </div>
                        </div>
                        
                        <!-- Risk Assessment Matrix -->
                        <div class="mb-8">
                            <h4 class="font-semibold mb-4 text-gray-700">Risk Assessment Matrix</h4>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="grid grid-cols-5 gap-2 mb-2">
                                    <div class="text-center text-xs font-medium text-gray-500">Severity ‚Üí<br>Probability ‚Üì</div>
                                    <div class="text-center text-xs font-medium p-2 bg-green-100 text-green-800 rounded">MINOR</div>
                                    <div class="text-center text-xs font-medium p-2 bg-yellow-100 text-yellow-800 rounded">MODERATE</div>
                                    <div class="text-center text-xs font-medium p-2 bg-orange-100 text-orange-800 rounded">MAJOR</div>
                                    <div class="text-center text-xs font-medium p-2 bg-red-100 text-red-800 rounded">CRITICAL</div>
                                </div>
                                <div class="grid grid-cols-5 gap-2">
                                    <div class="text-center text-xs font-medium p-2 bg-green-50 text-green-700 rounded">RARE</div>
                                    <div class="text-center text-xs p-2 bg-green-200 text-green-900 rounded">LOW</div>
                                    <div class="text-center text-xs p-2 bg-green-300 text-green-900 rounded">LOW</div>
                                    <div class="text-center text-xs p-2 bg-yellow-200 text-yellow-900 rounded">MEDIUM</div>
                                    <div class="text-center text-xs p-2 bg-orange-200 text-orange-900 rounded">HIGH</div>
                                </div>
                                <div class="grid grid-cols-5 gap-2 mt-1">
                                    <div class="text-center text-xs font-medium p-2 bg-blue-50 text-blue-700 rounded">UNLIKELY</div>
                                    <div class="text-center text-xs p-2 bg-green-300 text-green-900 rounded">LOW</div>
                                    <div class="text-center text-xs p-2 bg-yellow-200 text-yellow-900 rounded">MEDIUM</div>
                                    <div class="text-center text-xs p-2 bg-orange-300 text-orange-900 rounded">HIGH</div>
                                    <div class="text-center text-xs p-2 bg-red-200 text-red-900 rounded">HIGH</div>
                                </div>
                                <div class="grid grid-cols-5 gap-2 mt-1">
                                    <div class="text-center text-xs font-medium p-2 bg-yellow-50 text-yellow-700 rounded">POSSIBLE</div>
                                    <div class="text-center text-xs p-2 bg-yellow-300 text-yellow-900 rounded">MEDIUM</div>
                                    <div class="text-center text-xs p-2 bg-orange-200 text-orange-900 rounded">HIGH</div>
                                    <div class="text-center text-xs p-2 bg-red-300 text-red-900 rounded">HIGH</div>
                                    <div class="text-center text-xs p-2 bg-red-400 text-white rounded">EXTREME</div>
                                </div>
                                <div class="grid grid-cols-5 gap-2 mt-1">
                                    <div class="text-center text-xs font-medium p-2 bg-orange-50 text-orange-700 rounded">LIKELY</div>
                                    <div class="text-center text-xs p-2 bg-orange-300 text-orange-900 rounded">HIGH</div>
                                    <div class="text-center text-xs p-2 bg-red-200 text-red-900 rounded">HIGH</div>
                                    <div class="text-center text-xs p-2 bg-red-400 text-white rounded">EXTREME</div>
                                    <div class="text-center text-xs p-2 bg-red-500 text-white rounded">EXTREME</div>
                                </div>
                                <div class="grid grid-cols-5 gap-2 mt-1">
                                    <div class="text-center text-xs font-medium p-2 bg-red-50 text-red-700 rounded">ALMOST CERTAIN</div>
                                    <div class="text-center text-xs p-2 bg-red-300 text-red-900 rounded">HIGH</div>
                                    <div class="text-center text-xs p-2 bg-red-400 text-white rounded">EXTREME</div>
                                    <div class="text-center text-xs p-2 bg-red-500 text-white rounded">EXTREME</div>
                                    <div class="text-center text-xs p-2 bg-red-600 text-white rounded">EXTREME</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Overpull Risk Calculator -->
                        <div class="bg-white p-6 rounded-lg border-2 border-red-200 mb-8">
                            <h4 class="font-semibold mb-4 text-red-700 flex items-center gap-2">
                                <i class="fas fa-weight-hanging text-red-500"></i>
                                Overpull Risk Calculator
                            </h4>
                            <p class="text-sm text-gray-600 mb-4">Calculate maximum safe overpull based on rig capacity and tubular strength</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Rig Derrick Capacity (tons)</label>
                                    <select id="rigCapacity" class="w-full px-3 py-2 border rounded-lg">
                                        <option value="150">150 tons (Small Land Rig)</option>
                                        <option value="250" selected>250 tons (Medium Land Rig)</option>
                                        <option value="400">400 tons (Large Land Rig)</option>
                                        <option value="600">600 tons (Offshore Platform Rig)</option>
                                        <option value="800">800 tons (Jack-up Rig)</option>
                                        <option value="1000">1000 tons (Deepwater Rig)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tubular Type</label>
                                    <select id="tubularType" class="w-full px-3 py-2 border rounded-lg">
                                        <option value="2_7_8">2-7/8" Tubing (6.5 lb/ft)</option>
                                        <option value="3_1_2" selected>3-1/2" Tubing (9.2 lb/ft)</option>
                                        <option value="4_1_2">4-1/2" Drill Pipe (16.6 lb/ft)</option>
                                        <option value="5">5" Drill Pipe (19.5 lb/ft)</option>
                                        <option value="5_1_2">5-1/2" Drill Pipe (24.7 lb/ft)</option>
                                        <option value="6_5_8">6-5/8" Drill Pipe (32.6 lb/ft)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Fish Weight (tons)</label>
                                    <input type="number" id="fishWeight" class="w-full px-3 py-2 border rounded-lg" value="50" min="0" step="0.1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Fish Age in Well</label>
                                    <select id="fishAge" class="w-full px-3 py-2 border rounded-lg">
                                        <option value="1.0">Less than 2 years</option>
                                        <option value="1.2">2 to 5 years</option>
                                        <option value="1.5">More than 5 years</option>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">Automatically synchronized from "Fill in Data" tab</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Safety Factor</label>
                                    <select id="safetyFactor" class="w-full px-3 py-2 border rounded-lg">
                                        <option value="1.5">1.5 (High Risk)</option>
                                        <option value="1.75">1.75 (Medium Risk)</option>
                                        <option value="2.0" selected>2.0 (Standard)</option>
                                        <option value="2.5">2.5 (Conservative)</option>
                                        <option value="3.0">3.0 (High Safety)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Risk Tolerance</label>
                                    <select id="riskTolerance" class="w-full px-3 py-2 border rounded-lg">
                                        <option value="0.7">High Risk (70% of max)</option>
                                        <option value="0.8" selected>Standard (80% of max)</option>
                                        <option value="0.9">Conservative (90% of max)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button id="calculateOverpullBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg mb-6">
                                <i class="fas fa-calculator mr-2"></i>Calculate Overpull Risk
                            </button>
                            
                            <div id="overpullResult" class="hidden p-4 bg-gradient-to-r from-blue-50 to-red-50 rounded-lg border border-red-200">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="text-center">
                                        <div class="text-sm text-gray-600">Maximum Safe Pull</div>
                                        <div id="maxSafePull" class="text-2xl font-bold text-green-600">0 tons</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm text-gray-600">Adjusted Tubular Strength</div>
                                        <div id="tubularYield" class="text-2xl font-bold text-blue-600">0 tons</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm">Risk Level</span>
                                        <span id="overpullRiskLevel" class="font-bold">--</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-4">
                                        <div id="overpullRiskBar" class="h-4 rounded-full transition-all duration-1000"></div>
                                    </div>
                                </div>
                                
                                <div id="overpullRecommendations" class="text-sm space-y-2">
                                    <!-- Recommendations will appear here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- HSSE Risk Assessment -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <!-- Risk Calculator -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200">
                                <h4 class="font-semibold mb-4 text-gray-700 flex items-center gap-2">
                                    <i class="fas fa-calculator text-blue-500"></i>
                                    Risk Calculator
                                </h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Hazard Severity</label>
                                        <select id="severitySelect" class="w-full px-3 py-2 border rounded-lg">
                                            <option value="1">Minor (1) - Minor injury, first aid</option>
                                            <option value="2">Moderate (2) - Medical treatment, lost time</option>
                                            <option value="3">Major (3) - Serious injury, disability</option>
                                            <option value="4">Critical (4) - Fatality, multiple injuries</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Probability of Occurrence</label>
                                        <select id="probabilitySelect" class="w-full px-3 py-2 border rounded-lg">
                                            <option value="1">Rare (1) - May occur only in exceptional circumstances</option>
                                            <option value="2">Unlikely (2) - Could occur sometime</option>
                                            <option value="3">Possible (3) - Might occur occasionally</option>
                                            <option value="4">Likely (4) - Will probably occur</option>
                                            <option value="5">Almost Certain (5) - Expected to occur</option>
                                        </select>
                                    </div>
                                    <button id="calculateRiskBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg">
                                        Calculate Risk Level
                                    </button>
                                    <div id="riskResult" class="hidden p-4 rounded-lg text-center">
                                        <div id="riskLevel" class="text-lg font-bold mb-2"></div>
                                        <div id="riskCategory" class="text-sm"></div>
                                        <div id="riskActions" class="text-xs mt-2"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- PPE Requirements -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200">
                                <h4 class="font-semibold mb-4 text-gray-700 flex items-center gap-2">
                                    <i class="fas fa-hard-hat text-orange-500"></i>
                                    PPE Requirements
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                        <input type="checkbox" id="ppe1" class="rounded">
                                        <label for="ppe1" class="flex-1">Hard hat with chin strap</label>
                                    </div>
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                        <input type="checkbox" id="ppe2" class="rounded">
                                        <label for="ppe2" class="flex-1">Safety glasses with side shields</label>
                                    </div>
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                        <input type="checkbox" id="ppe3" class="rounded">
                                        <label for="ppe3" class="flex-1">Hearing protection</label>
                                    </div>
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                        <input type="checkbox" id="ppe4" class="rounded">
                                        <label for="ppe4" class="flex-1">Fire-resistant clothing</label>
                                    </div>
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                        <input type="checkbox" id="ppe5" class="rounded">
                                        <label for="ppe5" class="flex-1">Steel-toed boots</label>
                                    </div>
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                        <input type="checkbox" id="ppe6" class="rounded">
                                        <label for="ppe6" class="flex-1">Gloves (chemical/cut resistant)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Common Fishing Hazards -->
                        <div class="mb-8">
                            <h4 class="font-semibold mb-4 text-gray-700">Common Fishing Operation Hazards</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="hsse-critical p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-bold text-red-700">High Pressure Hazards</h5>
                                        <div class="hsse-rating rating-critical">4</div>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">Uncontrolled pressure release during fishing operations</p>
                                    <ul class="text-xs text-gray-600 list-disc list-inside">
                                        <li>Use proper BOP stack</li>
                                        <li>Pressure test all equipment</li>
                                        <li>Maintain safe distance</li>
                                    </ul>
                                </div>
                                <div class="hsse-high p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-bold text-orange-700">Jarring Impact Hazards</h5>
                                        <div class="hsse-rating rating-high">3</div>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">Sudden jarring motions causing equipment failure</p>
                                    <ul class="text-xs text-gray-600 list-disc list-inside">
                                        <li>Secure all loose items</li>
                                        <li>Establish exclusion zones</li>
                                        <li>Use proper rigging</li>
                                    </ul>
                                </div>
                                <div class="hsse-medium p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-bold text-yellow-700">Chemical Exposure</h5>
                                        <div class="hsse-rating rating-medium">2</div>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">Contact with spotting fluids and chemicals</p>
                                    <ul class="text-xs text-gray-600 list-disc list-inside">
                                        <li>MSDS review required</li>
                                        <li>Proper ventilation</li>
                                        <li>Emergency showers available</li>
                                    </ul>
                                </div>
                                <div class="hsse-high p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-bold text-orange-700">Stuck Pipe Emergencies</h5>
                                        <div class="hsse-rating rating-high">3</div>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">Sudden pipe movement or release</p>
                                    <ul class="text-xs text-gray-600 list-disc list-inside">
                                        <li>Regular pressure monitoring</li>
                                        <li>Establish safe zones</li>
                                        <li>Emergency response plan</li>
                                    </ul>
                                </div>
                                <div class="hsse-medium p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-bold text-yellow-700">Environmental Contamination</h5>
                                        <div class="hsse-rating rating-medium">2</div>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">Fluid spills and environmental impact</p>
                                    <ul class="text-xs text-gray-600 list-disc list-inside">
                                        <li>Containment systems in place</li>
                                        <li>Spill response equipment</li>
                                        <li>Environmental monitoring</li>
                                    </ul>
                                </div>
                                <div class="hsse-low p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-bold text-green-700">Noise Exposure</h5>
                                        <div class="hsse-rating rating-low">1</div>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">High noise levels from equipment</p>
                                    <ul class="text-xs text-gray-600 list-disc list-inside">
                                        <li>Hearing protection mandatory</li>
                                        <li>Noise level monitoring</li>
                                        <li>Regular hearing tests</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Emergency Procedures -->
                        <div class="bg-gradient-to-r from-red-50 to-orange-50 p-6 rounded-lg border border-red-200">
                            <h4 class="font-semibold mb-4 text-red-700 flex items-center gap-2">
                                <i class="fas fa-exclamation-triangle"></i>
                                Emergency Procedures
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h5 class="font-medium mb-2 text-red-800">Emergency Contact Numbers</h5>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Medical Emergency:</span>
                                            <span class="font-bold">911 / 112</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Site Safety Officer:</span>
                                            <span class="font-bold">+62-XXX-XXX-XXXX</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Environmental Response:</span>
                                            <span class="font-bold">+62-XXX-XXX-XXXX</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Fire Department:</span>
                                            <span class="font-bold">113</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium mb-2 text-red-800">Emergency Assembly Points</h5>
                                    <ul class="text-sm list-disc list-inside space-y-1">
                                        <li>Main muster point: North end of rig floor</li>
                                        <li>Secondary muster point: Toolpusher office</li>
                                        <li>Emergency evacuation: Designated helipad</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Analysis Tab -->
                <div id="ai-analysis" class="tab-content">
                    <!-- Updated Header with Logo -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <!-- JoRUN AI Logo -->
                            <div class="relative">
                                <img src="https://github.com/fadelgifari/CRSSC/releases/download/Alpha/Picture2.png" 
                                     alt="JoRUN AI Logo" 
                                     class="w-16 h-16 object-contain logo-glow">
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-blue-800">JoRUN AI</h2>
                                <p class="text-sm text-purple-600">Journey of Optimal Recovery and Unlocking New Potential</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg font-bold">
                            <i class="fas fa-bolt mr-2"></i>LIVE ANALYSIS
                        </div>
                    </div>
                    
                    <div class="ai-analysis-panel p-6 rounded-lg shadow-lg mb-6 border-2 border-purple-300 glow-border">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="relative">
                                <div class="absolute inset-0 bg-purple-500 rounded-full animate-ping opacity-20"></div>
                            </div>
                           
                            <div class="ml-auto bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-2 rounded-lg font-bold">
                                <i class="fas fa-brain mr-2"></i>ACTIVE
                            </div>
                        </div>
                        
                        <!-- Historical Well & Fish Management -->
                        <div class="bg-white rounded-xl shadow-sm border p-6 mb-8">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="font-semibold text-blue-700 text-lg flex items-center gap-2">
                                    <i class="fas fa-database text-blue-500"></i>
                                    Historical Well & Fish Management
                                </h4>
                                <div class="flex gap-3">
                                    <button id="saveCurrentWellBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                        <i class="fas fa-save"></i>
                                        Save Current Well
                                    </button>
                                    <button id="addFishAIBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                        <i class="fas fa-plus"></i>
                                        Add Fish Entry
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Fish Entries in AI Tab -->
                            <div class="mb-6">
                                <h5 class="font-medium text-gray-700 mb-3">Current Fish Entries</h5>
                                <div id="aiFishEntriesContainer" class="space-y-3 mb-4">
                                    <!-- Fish entries will appear here -->
                                </div>
                                <div id="noFishAI" class="text-center p-4 bg-gray-50 rounded-lg border border-gray-200">
                                    <i class="fas fa-fish text-2xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-500">No fish entries added yet</p>
                                    <p class="text-sm text-gray-400 mt-1">Click "Add Fish Entry" to start</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Historical Well Selection -->
                                <div>
                                    <h5 class="font-medium text-gray-700 mb-3">Historical Well Database</h5>
                                    <p class="text-gray-600 mb-3 text-sm">Select a previously saved well to load parameters:</p>
                                    <div class="space-y-3 max-h-64 overflow-y-auto p-2" id="historicalWellsContainer">
                                        <!-- Historical wells will be loaded here -->
                                    </div>
                                    <div id="noWellsMessage" class="text-center p-4 bg-gray-50 rounded-lg border border-gray-200">
                                        <i class="fas fa-database text-2xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-500">No historical wells saved yet</p>
                                        <p class="text-sm text-gray-400 mt-1">Fill in well data and click "Save Current Well"</p>
                                    </div>
                                </div>
                                
                                <!-- Well Information Display -->
                                <div>
                                    <h5 class="font-medium text-gray-700 mb-3">Current Well Information</h5>
                                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-sm text-gray-600">Well Name:</span>
                                                <span class="font-medium" id="aiWellName">--</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-sm text-gray-600">Field:</span>
                                                <span class="font-medium" id="aiFieldName">--</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-sm text-gray-600">Entry Type:</span>
                                                <span class="font-medium" id="aiEntryType">--</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-sm text-gray-600">Fish Count:</span>
                                                <span class="font-medium" id="aiFishCount">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 text-sm text-gray-500 border-t pt-4">
                                        <p><i class="fas fa-info-circle mr-2 text-blue-500"></i><strong>Note:</strong> You can add fish entries directly in this tab or use the main "Fill in Data" tab.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                            <!-- AI Brain Section -->
                            <div class="bg-gradient-to-br from-purple-50 to-blue-50 p-6 rounded-xl border border-purple-200">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-brain text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-purple-800">Neural Analysis</h4>
                                        <p class="text-xs text-purple-600">Processing 12+ parameters</p>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">Pattern Recognition</span>
                                        <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div class="h-full bg-green-500 animate-pulse" style="width: 92%"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">Risk Assessment</span>
                                        <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div class="h-full bg-blue-500 animate-pulse" style="width: 87%"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">Success Prediction</span>
                                        <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div class="h-full bg-purple-500 animate-pulse" style="width: 95%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Live Analysis Control -->
                            <div class="bg-white p-6 rounded-xl border border-blue-200">
                                <h4 class="font-semibold mb-4 text-blue-700 flex items-center gap-2">
                                    <i class="fas fa-play-circle text-blue-500"></i>
                                    Analysis Control
                                </h4>
                                <button id="runAiAnalysis" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-xl flex items-center justify-center gap-3 mb-4 ai-pulse">
                                    <i class="fas fa-rocket"></i>
                                    LAUNCH EXPERT ANALYSIS
                                </button>
                                <div class="text-center">
                                    <button id="saveAiReport" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg inline-flex items-center gap-2">
                                        <i class="fas fa-file-export"></i>
                                        Export AI Report
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Quick Stats -->
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-200">
                                <h4 class="font-semibold mb-4 text-blue-700">Analysis Stats</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                                        <div class="text-2xl font-bold text-blue-600" id="aiWellCount">0</div>
                                        <div class="text-xs text-gray-500">Wells Analyzed</div>
                                    </div>
                                    <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                                        <div class="text-2xl font-bold text-green-600" id="aiSuccessRate">0%</div>
                                        <div class="text-xs text-gray-500">Avg. Accuracy</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Analysis Dashboard -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Left Column: Input Analysis -->
                            <div class="lg:col-span-2">
                                <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h4 class="font-semibold text-blue-700 text-lg flex items-center gap-2">
                                            <i class="fas fa-cogs text-blue-500"></i>
                                            Expert System Analysis
                                        </h4>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium flex items-center gap-1">
                                            <i class="fas fa-microchip"></i>
                                            ACTIVE
                                        </span>
                                    </div>
                                    
                                    <div class="space-y-4">
                                        <!-- Parameter Analysis Cards -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                            <div class="bg-gradient-to-r from-blue-50 to-white p-4 rounded-lg border border-blue-100">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="font-medium text-blue-700">Casing Integrity</span>
                                                    <span class="text-xs px-2 py-1 rounded-full" id="aiCasingScore">--</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div id="aiCasingBar" class="h-2 rounded-full transition-all duration-1000"></div>
                                                </div>
                                            </div>
                                            
                                            <div class="bg-gradient-to-r from-green-50 to-white p-4 rounded-lg border border-green-100">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="font-medium text-green-700">Fish Accessibility</span>
                                                    <span class="text-xs px-2 py-1 rounded-full" id="aiAccessScore">--</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div id="aiAccessBar" class="h-2 rounded-full transition-all duration-1000"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- AI Thinking Process -->
                                        <div id="aiThinkingProcess" class="hidden space-y-3">
                                            <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-search text-blue-600 text-sm"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <div class="font-medium text-sm">Analyzing well parameters...</div>
                                                    <div class="text-xs text-gray-500">Processing 12 critical factors</div>
                                                </div>
                                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                                            </div>
                                            
                                            <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-calculator text-green-600 text-sm"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <div class="font-medium text-sm">Calculating economic viability...</div>
                                                    <div class="text-xs text-gray-500">Running financial simulations</div>
                                                </div>
                                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-green-600"></div>
                                            </div>
                                            
                                            <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
                                                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-brain text-purple-600 text-sm"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <div class="font-medium text-sm">Generating recommendations...</div>
                                                    <div class="text-xs text-gray-500">Applying expert knowledge base</div>
                                                </div>
                                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- AI Results -->
                                        <div id="aiResults" class="hidden space-y-4">
                                            <!-- Success Prediction -->
                                            <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-xl border border-purple-200">
                                                <div class="flex items-center justify-between mb-4">
                                                    <h5 class="font-bold text-purple-800 text-lg gradient-text">EXPERT VERDICT</h5>
                                                    <div class="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-full text-sm font-bold" id="aiVerdict">
                                                        ANALYZING...
                                                    </div>
                                                </div>
                                                
                                                <div class="grid grid-cols-2 gap-6">
                                                    <div class="text-center">
                                                        <div class="text-4xl font-bold mb-2" id="aiSuccessRateResult">0%</div>
                                                        <div class="text-sm text-gray-600">SUCCESS PROBABILITY</div>
                                                        <div class="mt-2">
                                                            <div class="w-full bg-gray-200 rounded-full h-3">
                                                                <div id="aiSuccessBar" class="h-3 rounded-full transition-all duration-1500"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="text-4xl font-bold mb-2" id="aiEftResult">0</div>
                                                        <div class="text-sm text-gray-600">ECONOMIC DAYS</div>
                                                        <div class="mt-2">
                                                            <div class="text-xs" id="aiEftLabel">Calculating...</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Economic Analysis -->
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div class="bg-white p-4 rounded-lg border border-blue-200">
                                                    <div class="flex items-center gap-2 mb-3">
                                                        <i class="fas fa-dollar-sign text-green-500"></i>
                                                        <h6 class="font-semibold">COST ANALYSIS</h6>
                                                    </div>
                                                    <div class="space-y-2">
                                                        <div class="flex justify-between">
                                                            <span class="text-sm">Estimated Cost:</span>
                                                            <span class="font-bold" id="aiCostEstimate">$0</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-sm">Cycle Time:</span>
                                                            <span class="font-bold" id="aiCycleTime">0 days</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-sm">Daily Rate:</span>
                                                            <span class="font-bold" id="aiDailyRate">$0</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="bg-white p-4 rounded-lg border border-green-200">
                                                    <div class="flex items-center gap-2 mb-3">
                                                        <i class="fas fa-chart-line text-blue-500"></i>
                                                        <h6 class="font-semibold">VIABILITY SCORE</h6>
                                                    </div>
                                                    <div class="text-center">
                                                        <div class="text-3xl font-bold mb-1" id="aiViabilityScore">0</div>
                                                        <div class="text-xs text-gray-500">/100 POINTS</div>
                                                        <div class="mt-2 text-sm" id="aiViabilityLabel">Calculating...</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Column: Recommendations & Insights -->
                            <div>
                                <!-- AI Recommendations -->
                                <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                                    <h4 class="font-semibold mb-4 text-blue-700 flex items-center gap-2">
                                        <i class="fas fa-lightbulb text-yellow-500"></i>
                                        AI RECOMMENDATIONS
                                    </h4>
                                    
                                    <div id="aiRecommendationsList" class="space-y-3">
                                        <div class="ai-thinking p-4 rounded-lg text-center">
                                            <img src="https://github.com/fadelgifari/CRSSC/releases/download/Alpha/Picture2.png" 
                                                 alt="JoRUN AI Logo" 
                                                 class="inline-block w-6 h-6 object-contain mr-2">
                                            <p class="text-purple-600">Awaiting analysis input...</p>
                                            <p class="text-sm text-purple-500 mt-2">Enter well data and click LAUNCH</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Risk Assessment -->
                                <div class="bg-white rounded-xl shadow-sm border p-6">
                                    <h4 class="font-semibold mb-4 text-red-700 flex items-center gap-2">
                                        <i class="fas fa-exclamation-triangle text-red-500"></i>
                                        RISK ASSESSMENT
                                    </h4>
                                    
                                    <div id="aiRiskAssessment" class="space-y-3">
                                        <div class="text-center text-gray-500 py-4">
                                            <i class="fas fa-shield-alt text-2xl mb-2"></i>
                                            <p class="text-sm">No risks identified yet</p>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 pt-4 border-t">
                                        <h5 class="font-medium mb-2 text-gray-700">AI Confidence Level</h5>
                                        <div class="flex items-center gap-3">
                                            <div class="flex-1 bg-gray-200 rounded-full h-2">
                                                <div id="aiConfidenceBar" class="h-2 rounded-full bg-green-500" style="width: 0%"></div>
                                            </div>
                                            <span id="aiConfidenceText" class="text-sm font-bold">--%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fishing Selection Guide Tab -->
                <div id="selection-guide" class="tab-content">
                    <h2 class="text-xl font-semibold mb-6 text-blue-800">Fishing Selection Guide</h2>
                    
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-blue-700">Interactive Tool Selection Matrix</h3>
                        <p class="text-gray-600 mb-4">Select your fish type and well conditions to get recommended fishing tools:</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-gray-700 mb-2">Fish Type</label>
                                <select id="guideFishType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Fish Type</option>
                                    <option value="packer">Packer</option>
                                    <option value="tubular">Tubular</option>
                                    <option value="bha">Drilling BHA</option>
                                    <option value="junk">Junk</option>
                                    <option value="liner">Liner</option>
                                    <option value="casing">Casing</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Well Condition</label>
                                <select id="guideWellCondition" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Well Condition</option>
                                    <option value="open">Open Hole</option>
                                    <option value="cased">Cased Hole</option>
                                    <option value="damaged">Damaged Casing</option>
                                </select>
                            </div>
                        </div>
                        
                        <button id="guideRecommendBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg mb-6">
                            Get Tool Recommendations
                        </button>
                        
                        <div id="toolRecommendationResult" class="hidden bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">Recommended Tools:</h4>
                            <div id="recommendedToolsList" class="space-y-2">
                                <!-- Results will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="guide-category">
                            <h3 class="text-lg font-semibold mb-3 text-blue-700">Fishing Tool Categories</h3>
                            <div class="space-y-3">
                                <div class="p-3 bg-green-50 rounded-lg border border-green-200">
                                    <h4 class="font-medium text-green-800">Catching Tools</h4>
                                    <p class="text-sm text-gray-600">Overshots, spears, taps for engaging fish</p>
                                </div>
                                <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <h4 class="font-medium text-yellow-800">Junk Fishing Tools</h4>
                                    <p class="text-sm text-gray-600">Baskets, magnets, mills for small debris</p>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                    <h4 class="font-medium text-blue-800">Cutting Tools</h4>
                                    <p class="text-sm text-gray-600">Chemical cutters, mechanical cutters</p>
                                </div>
                                <div class="p-3 bg-purple-50 rounded-lg border border-purple-200">
                                    <h4 class="font-medium text-purple-800">Fishing Jars</h4>
                                    <p class="text-sm text-gray-600">Mechanical and hydraulic jars for impact</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="guide-category">
                            <h3 class="text-lg font-semibold mb-3 text-blue-700">Selection Criteria</h3>
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <i class="fas fa-ruler-combined text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Fish Size & Shape</h4>
                                        <p class="text-sm text-gray-600">Match tool size to fish OD/ID</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-hard-hat text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Wellbore Conditions</h4>
                                        <p class="text-sm text-gray-600">Consider casing restrictions, hole angle</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-weight-hanging text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Fish Weight</h4>
                                        <p class="text-sm text-gray-600">Ensure tool can handle expected loads</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-history text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Fishing History</h4>
                                        <p class="text-sm text-gray-600">Consider previous attempts and results</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fishing BHA Design Tab -->
                <div id="bha-design" class="tab-content">
                    <h2 class="text-xl font-semibold mb-6 text-blue-800">Fishing BHA Design</h2>
                    
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-blue-700">Interactive BHA Builder</h3>
                        <p class="text-gray-600 mb-4">Drag and drop components to build your fishing BHA:</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="col-span-1">
                                <h4 class="font-medium mb-3 text-gray-700">Available Components</h4>
                                <div class="space-y-2">
                                    <div class="bha-component" draggable="true" data-component="fishing-tool">
                                        <div class="font-medium">Fishing Tool</div>
                                        <div class="text-sm text-gray-500">Overshot, spear, or tap</div>
                                    </div>
                                    <div class="bha-component" draggable="true" data-component="fishing-jar">
                                        <div class="font-medium">Fishing Jar</div>
                                        <div class="text-sm text-gray-500">Mechanical or hydraulic</div>
                                    </div>
                                    <div class="bha-component" draggable="true" data-component="accelerator">
                                        <div class="font-medium">Accelerator</div>
                                        <div class="text-sm text-gray-500">For jar impact enhancement</div>
                                    </div>
                                    <div class="bha-component" draggable="true" data-component="drill-collar">
                                        <div class="font-medium">Drill Collar</div>
                                        <div class="text-sm text-gray-500">Weight for jarring</div>
                                    </div>
                                    <div class="bha-component" draggable="true" data-component="stabilizer">
                                        <div class="font-medium">Stabilizer</div>
                                        <div class="text-sm text-gray-500">Centralize the BHA</div>
                                    </div>
                                    <div class="bha-component" draggable="true" data-component="kelly-cock">
                                        <div class="font-medium">Kelly Cock</div>
                                        <div class="text-sm text-gray-500">Safety valve</div>
                                    </div>
                                    <div class="bha-component" draggable="true" data-component="jar-intensifier">
                                        <div class="font-medium">Jar Intensifier</div>
                                        <div class="text-sm text-gray-500">Increase jarring force</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-span-2">
                                <h4 class="font-medium mb-3 text-gray-700">Your BHA Assembly</h4>
                                <div id="bha-assembly-area" class="bha-preview">
                                    <div class="text-center text-gray-500 py-16">
                                        <i class="fas fa-arrow-down text-2xl mb-2"></i>
                                        <p>Drag components here to build your BHA</p>
                                    </div>
                                </div>
                                
                                <div class="mt-4 flex justify-between">
                                    <button id="resetBhaBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                                        Reset BHA
                                    </button>
                                    <button id="saveBhaBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                        Save BHA Design
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4 text-blue-700">Standard BHA Templates</h3>
                            <div class="space-y-4">
                                <div class="p-4 border rounded-lg cursor-pointer hover:bg-blue-50" onclick="loadBhaTemplate('standard')">
                                    <h4 class="font-medium">Standard Fishing BHA</h4>
                                    <p class="text-sm text-gray-600">Fishing Tool + Jar + Drill Collars + Kelly Cock</p>
                                </div>
                                <div class="p-4 border rounded-lg cursor-pointer hover:bg-blue-50" onclick="loadBhaTemplate('heavy-duty')">
                                    <h4 class="font-medium">Heavy Duty BHA</h4>
                                    <p class="text-sm text-gray-600">Fishing Tool + Intensifier + Jar + Accelerator + Heavy Drill Collars</p>
                                </div>
                                <div class="p-4 border rounded-lg cursor-pointer hover:bg-blue-50" onclick="loadBhaTemplate('junk-basket')">
                                    <h4 class="font-medium">Junk Fishing BHA</h4>
                                    <p class="text-sm text-gray-600">Junk Basket + Magnets + Mills + Stabilizers</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4 text-blue-700">BHA Design Principles</h3>
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <i class="fas fa-balance-scale text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Weight Distribution</h4>
                                        <p class="text-sm text-gray-600">Place sufficient weight above jar for effective impact</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-compress-arrows-alt text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Jar Placement</h4>
                                        <p class="text-sm text-gray-600">Position jar close to fishing tool for direct force transfer</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-shield-alt text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Safety Considerations</h4>
                                        <p class="text-sm text-gray-600">Include safety valves and weak points</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-ruler-combined text-blue-500 mt-1 mr-2"></i>
                                    <div>
                                        <h4 class="font-medium">Clearance Check</h4>
                                        <p class="text-sm text-gray-600">Ensure all components pass through restrictions</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BHA Based on Fish Type Tab -->
                <div id="fish-type-bha" class="tab-content">
                    <h2 class="text-xl font-semibold mb-6 text-blue-800">BHA Based on Fish Type</h2>
                    
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-blue-700">Fish Type Selection</h3>
                        <p class="text-gray-600 mb-4">Select a fish type to view recommended BHA configuration:</p>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <button class="fish-type-btn p-4 bg-blue-100 rounded-lg text-center hover:bg-blue-200 transition-colors" data-fish-type="packer">
                                <i class="fas fa-cube text-2xl text-blue-600 mb-2"></i>
                                <div class="font-medium">Packer</div>
                            </button>
                            <button class="fish-type-btn p-4 bg-green-100 rounded-lg text-center hover:bg-green-200 transition-colors" data-fish-type="tubular">
                                <i class="fas fa-pipe text-2xl text-green-600 mb-2"></i>
                                <div class="font-medium">Tubular</div>
                            </button>
                            <button class="fish-type-btn p-4 bg-yellow-100 rounded-lg text-center hover:bg-yellow-200 transition-colors" data-fish-type="bha">
                                <i class="fas fa-tools text-2xl text-yellow-600 mb-2"></i>
                                <div class="font-medium">BHA</div>
                            </button>
                            <button class="fish-type-btn p-4 bg-red-100 rounded-lg text-center hover:bg-red-200 transition-colors" data-fish-type="junk">
                                <i class="fas fa-cogs text-2xl text-red-600 mb-2"></i>
                                <div class="font-medium">Junk</div>
                            </button>
                        </div>
                        
                        <div id="fish-bha-result" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold mb-3 text-blue-700">Recommended BHA</h4>
                                    <div id="bha-diagram" class="bha-diagram">
                                        <!-- BHA diagram will be generated here -->
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-3 text-blue-700">Tool Recommendations</h4>
                                    <div id="tool-recommendations" class="space-y-3">
                                        <!-- Tool recommendations will appear here -->
                                    </div>
                                    
                                    <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                        <h5 class="font-medium text-yellow-800 mb-2">Key Considerations</h5>
                                        <div id="key-considerations" class="text-sm text-gray-700">
                                            <!-- Key considerations will appear here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fish-type-grid">
                        <div class="fish-type-card complexity-medium">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-semibold text-lg">Packer Fishing</h3>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium">Medium Complexity</span>
                            </div>
                            <p class="text-gray-600 mb-3">Retrieving stuck packers or completion equipment</p>
                            <div class="text-sm">
                                <div class="font-medium mb-1">Recommended Tools:</div>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Overshots with packer grapples</li>
                                    <li>Hydraulic jars</li>
                                    <li>Intensifiers</li>
                                    <li>Safety joints</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="fish-type-card complexity-low">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-semibold text-lg">Tubular Fishing</h3>
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium">Low Complexity</span>
                            </div>
                            <p class="text-gray-600 mb-3">Recovering stuck drill pipe, tubing, or casing</p>
                            <div class="text-sm">
                                <div class="font-medium mb-1">Recommended Tools:</div>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Overshots or spears</li>
                                    <li>Mechanical jars</li>
                                    <li>Drill collars for weight</li>
                                    <li>Rotating safety joints</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="fish-type-card complexity-high">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-semibold text-lg">BHA Fishing</h3>
                                <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium">High Complexity</span>
                            </div>
                            <p class="text-gray-600 mb-3">Retrieving stuck bottom hole assemblies</p>
                            <div class="text-sm">
                                <div class="font-medium mb-1">Recommended Tools:</div>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Internal fishing tools</li>
                                    <li>Junk baskets</li>
                                    <li>Mills for cleaning</li>
                                    <li>Heavy duty jars</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="fish-type-card complexity-medium">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="font-semibold text-lg">Junk Fishing</h3>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium">Medium Complexity</span>
                            </div>
                            <p class="text-gray-600 mb-3">Removing small debris or broken tool parts</p>
                            <div class="text-sm">
                                <div class="font-medium mb-1">Recommended Tools:</div>
                                <ul class="list-disc list-inside text-gray-600">
                                    <li>Junk baskets</li>
                                    <li>Magnets</li>
                                    <li>Core barrels</li>
                                    <li>Mills</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fishing Operation Guidance Tab -->
                <div id="operation-guidance" class="tab-content">
                    <h2 class="text-xl font-semibold mb-6 text-blue-800">Fishing Operation Guidance</h2>
                    
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-blue-700">Fishing Operation Checklist</h3>
                        <p class="text-gray-600 mb-4">Use this interactive checklist to ensure all preparation steps are completed:</p>
                        
                        <div class="space-y-4">
                            <div class="guide-category">
                                <h4 class="font-medium mb-3 text-blue-700">Pre-Job Planning</h4>
                                <div class="space-y-2">
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check1" class="rounded text-blue-600">
                                        <label for="check1" class="flex-1">Review fish details and well schematics</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check2" class="rounded text-blue-600">
                                        <label for="check2" class="flex-1">Select appropriate fishing tools and BHA</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check3" class="rounded text-blue-600">
                                        <label for="check3" class="flex-1">Develop contingency plans for different scenarios</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check4" class="rounded text-blue-600">
                                        <label for="check4" class="flex-1">Calculate maximum allowable overpull and torque</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="guide-category">
                                <h4 class="font-medium mb-3 text-blue-700">Equipment Preparation</h4>
                                <div class="space-y-2">
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check5" class="rounded text-blue-600">
                                        <label for="check5" class="flex-1">Inspect all fishing tools for damage or wear</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check6" class="rounded text-blue-600">
                                        <label for="check6" class="flex-1">Function test jars and other mechanical tools</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check7" class="rounded text-blue-600">
                                        <label for="check7" class="flex-1">Ensure backup tools are available on location</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check8" class="rounded text-blue-600">
                                        <label for="check8" class="flex-1">Verify tool dimensions and clearances</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="guide-category">
                                <h4 class="font-medium mb-3 text-blue-700">Operational Execution</h4>
                                <div class="space-y-2">
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check9" class="rounded text-blue-600">
                                        <label for="check9" class="flex-1">Tag fish top and establish reference point</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check10" class="rounded text-blue-600">
                                        <label for="check10" class="flex-1">Engage fish with controlled approach</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check11" class="rounded text-blue-600">
                                        <label for="check11" class="flex-1">Apply appropriate jarring program</label>
                                    </div>
                                    <div class="checklist-item">
                                        <input type="checkbox" id="check12" class="rounded text-blue-600">
                                        <label for="check12" class="flex-1">Monitor returns and pressure carefully</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Checklist Progress</span>
                                <span id="checklistProgress">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4 text-blue-700">Step-by-Step Operation Guide</h3>
                            <div class="space-y-4">
                                <div class="operation-step">
                                    <div class="flex items-center mb-2">
                                        <span class="step-number">1</span>
                                        <h4 class="font-medium">Preparation & Planning</h4>
                                    </div>
                                    <p class="text-gray-600">Gather all available information about the fish and well conditions. Select appropriate tools and develop a detailed fishing plan with contingencies.</p>
                                </div>
                                <div class="operation-step">
                                    <div class="flex items-center mb-2">
                                        <span class="step-number">2</span>
                                        <h4 class="font-medium">Tool String Assembly</h4>
                                    </div>
                                    <p class="text-gray-600">Assemble the fishing BHA according to the selected design. Perform function tests on all mechanical components before running in hole.</p>
                                </div>
                                <div class="operation-step">
                                    <div class="flex items-center mb-2">
                                        <span class="step-number">3</span>
                                        <h4 class="font-medium">Approach & Engagement</h4>
                                    </div>
                                    <p class="text-gray-600">Run in hole carefully to tag the fish top. Use controlled approach to engage the fish with the selected fishing tool.</p>
                                </div>
                                <div class="operation-step">
                                    <div class="flex items-center mb-2">
                                        <span class="step-number">4</span>
                                        <h4 class="font-medium">Jarring Operation</h4>
                                    </div>
                                    <p class="text-gray-600">Apply appropriate jarring force based on fish type and sticking mechanism. Monitor carefully for any movement or indication of release.</p>
                                </div>
                                <div class="operation-step">
                                    <div class="flex items-center mb-2">
                                        <span class="step-number">5</span>
                                        <h4 class="font-medium">Fish Recovery</h4>
                                    </div>
                                    <p class="text-gray-600">Once fish is free, carefully pull out of hole while monitoring weight and torque. Inspect recovered fish and document lessons learned.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4 text-blue-700">Common Challenges & Solutions</h3>
                            <div class="space-y-4">
                                <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                                    <h4 class="font-medium text-red-800 mb-2">Fish Not Engaging</h4>
                                    <p class="text-sm text-gray-700">If the fishing tool won't engage properly, consider:</p>
                                    <ul class="list-disc list-inside mt-1 text-sm text-gray-600">
                                        <li>Changing to a different style of fishing tool</li>
                                        <li>Using a milling tool to clean up fish top</li>
                                        <li>Verifying fish dimensions with caliper log</li>
                                    </ul>
                                </div>
                                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <h4 class="font-medium text-yellow-800 mb-2">Fish Not Releasing</h4>
                                    <p class="text-sm text-gray-700">If jarring isn't freeing the fish, try:</p>
                                    <ul class="list-disc list-inside mt-1 text-sm text-gray-600">
                                        <li>Increasing jarring force gradually</li>
                                        <li>Changing jarring rhythm or technique</li>
                                        <li>Applying chemical spotting fluid</li>
                                        <li>Considering back-off or cutting operation</li>
                                    </ul>
                                </div>
                                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                                    <h4 class="font-medium text-green-800 mb-2">Multiple Fish in Hole</h4>
                                    <p class="text-sm text-gray-700">When dealing with multiple fish:</p>
                                    <ul class="list-disc list-inside mt-1 text-sm text-gray-600">
                                        <li>Fish the topmost item first</li>
                                        <li>Use junk baskets to collect smaller debris</li>
                                        <li>Consider milling if fishing isn't feasible</li>
                                        <li>Document each recovery for future reference</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Key Success Factors</h4>
                                <ul class="list-disc list-inside text-sm text-gray-700">
                                    <li>Thorough pre-job planning and risk assessment</li>
                                    <li>Proper tool selection and function testing</li>
                                    <li>Patience and methodical approach during operations</li>
                                    <li>Continuous monitoring and adaptation to conditions</li>
                                    <li>Comprehensive documentation for future reference</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // UTILITY FUNCTIONS
        // =============================================
        
        // Fish age synchronization function
        function syncFishAgeFromMainForm() {
            const objectPeriod = document.getElementById('objectPeriod');
            if (!objectPeriod) return;
            
            const fishAgeSelect = document.getElementById('fishAge');
            if (!fishAgeSelect) return;
            
            // Map the values from main form to overpull calculator
            const valueMapping = {
                '0.04': '1.0',  // Less than 2 years
                '0.1': '1.2',   // 2 to 5 years
                '0.16': '1.5'   // More than 5 years
            };
            
            const mainValue = objectPeriod.value;
            if (valueMapping[mainValue]) {
                fishAgeSelect.value = valueMapping[mainValue];
            }
        }

        // =============================================
        // HISTORICAL WELL DATA MANAGEMENT
        // =============================================
        class HistoricalWellManager {
            constructor() {
                this.storageKey = 'historicalWells';
                this.currentSelectedWell = null;
                this.loadWells();
            }

            loadWells() {
                const stored = localStorage.getItem(this.storageKey);
                this.wells = stored ? JSON.parse(stored) : [];
                this.renderWells();
            }

            saveWells() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.wells));
                this.renderWells();
                this.updateAIStats();
            }

            saveCurrentWell() {
                const wellData = this.getCurrentWellData();
                if (!wellData.wellName) {
                    alert('Please enter a well name before saving.');
                    return false;
                }

                const existingIndex = this.wells.findIndex(w => w.wellName === wellData.wellName);
                
                if (existingIndex >= 0) {
                    if (confirm(`Well "${wellData.wellName}" already exists. Overwrite?`)) {
                        this.wells[existingIndex] = {
                            ...wellData,
                            id: this.wells[existingIndex].id,
                            savedDate: new Date().toISOString()
                        };
                    } else {
                        return false;
                    }
                } else {
                    this.wells.push({
                        ...wellData,
                        id: Date.now(),
                        savedDate: new Date().toISOString()
                    });
                }

                this.saveWells();
                return true;
            }

            getCurrentWellData() {
                const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
                const wellData = {
                    wellName: document.getElementById('wellName').value,
                    firstEntry: document.getElementById('firstEntry').value,
                    fieldName: document.getElementById('fieldName').value,
                    casingPartedCollapse: document.getElementById('casingPartedCollapse').value,
                    casingDamage: document.getElementById('casingDamage').value,
                    fishingType: document.getElementById('fishingType').value,
                    wellGeometry: document.getElementById('wellGeometry').value || '0.01',
                    wellGeometrySuccess: document.getElementById('wellGeometrySuccess').value || '1',
                    formationAbove: document.getElementById('formationAbove').value,
                    objectPeriod: document.getElementById('objectPeriod').value,
                    safetyJoint: document.getElementById('safetyJoint').value,
                    tailPresence: document.getElementById('tailPresence').value,
                    wellExTpa: document.getElementById('wellExTpa').value,
                    tofCondition: document.getElementById('tofCondition').value || '1',
                    fishDetailCondition: document.getElementById('fishDetailCondition').value || '1',
                    isFirstEntry: isFirstEntry
                };

                // Add economic data based on first entry status
                if (isFirstEntry) {
                    wellData.oilProductionFirst = document.getElementById('oilProductionFirst').value || '0';
                    wellData.oilPriceFirst = document.getElementById('oilPriceFirst').value || '0';
                    wellData.previousJobCost = '0';
                    wellData.oilProduction = '0';
                    wellData.oilPrice = '0';
                } else {
                    wellData.oilProduction = document.getElementById('oilProduction').value || '0';
                    wellData.oilPrice = document.getElementById('oilPrice').value || '0';
                    wellData.previousJobCost = document.getElementById('previousJobCost').value || '0';
                    wellData.oilProductionFirst = '0';
                    wellData.oilPriceFirst = '0';
                }

                // Get current fish entries
                wellData.fishEntries = this.getCurrentFishEntries();

                return wellData;
            }

            getCurrentFishEntries() {
                const entries = [];
                document.querySelectorAll('.fish-entry').forEach(entry => {
                    const fishType = entry.querySelector('.fish-type').value;
                    entries.push(fishType);
                });
                return entries;
            }

            loadWellData(wellId) {
                const well = this.wells.find(w => w.id === wellId);
                if (!well) return false;

                this.currentSelectedWell = well;
                
                // Clear existing fish entries
                this.clearFishEntries();
                
                // Load fish entries if they exist
                if (well.fishEntries && well.fishEntries.length > 0) {
                    well.fishEntries.forEach(fishType => {
                        this.addFishEntryToForm(fishType);
                    });
                } else {
                    // Show message but don't require going to fill in data tab
                    setTimeout(() => {
                        alert('Historical well loaded. You can add fish entries directly in this AI tab.');
                    }, 100);
                }
                
                // Load all form fields
                document.getElementById('wellName').value = well.wellName || '';
                document.getElementById('firstEntry').value = well.firstEntry || '';
                document.getElementById('fieldName').value = well.fieldName || '';
                document.getElementById('casingPartedCollapse').value = well.casingPartedCollapse || '1';
                document.getElementById('casingDamage').value = well.casingDamage || '1';
                document.getElementById('fishingType').value = well.fishingType || '1';
                document.getElementById('wellGeometry').value = well.wellGeometry || '0.01';
                document.getElementById('wellGeometrySuccess').value = well.wellGeometrySuccess || '1';
                document.getElementById('formationAbove').value = well.formationAbove || '0.015';
                document.getElementById('objectPeriod').value = well.objectPeriod || '0.04';
                document.getElementById('safetyJoint').value = well.safetyJoint || '0.05';
                document.getElementById('tailPresence').value = well.tailPresence || '0.0125';
                document.getElementById('wellExTpa').value = well.wellExTpa || '0.02';
                document.getElementById('tofCondition').value = well.tofCondition || '1';
                document.getElementById('fishDetailCondition').value = well.fishDetailCondition || '1';

                // Load economic data based on first entry status
                if (well.isFirstEntry) {
                    document.getElementById('oilProductionFirst').value = well.oilProductionFirst || '0';
                    document.getElementById('oilPriceFirst').value = well.oilPriceFirst || '0';
                    document.getElementById('oilProduction').value = '0';
                    document.getElementById('oilPrice').value = '0';
                    document.getElementById('previousJobCost').value = '0';
                } else {
                    document.getElementById('oilProduction').value = well.oilProduction || '0';
                    document.getElementById('oilPrice').value = well.oilPrice || '0';
                    document.getElementById('previousJobCost').value = well.previousJobCost || '0';
                    document.getElementById('oilProductionFirst').value = '0';
                    document.getElementById('oilPriceFirst').value = '0';
                }

                // Trigger change events to update UI
                document.getElementById('firstEntry').dispatchEvent(new Event('change'));
                
                // Sync fish age to HSSE tab
                syncFishAgeFromMainForm();
                
                // Update AI display
                this.updateAIDisplay();
                
                return true;
            }

            clearFishEntries() {
                // Clear from main form
                const fishEntriesContainer = document.getElementById('fishEntriesContainer');
                fishEntriesContainer.innerHTML = '';
                
                // Clear from AI display
                const aiFishContainer = document.getElementById('aiFishEntriesContainer');
                if (aiFishContainer) {
                    aiFishContainer.innerHTML = '';
                    const noFishAI = document.getElementById('noFishAI');
                    if (noFishAI) noFishAI.classList.remove('hidden');
                }
            }

            addFishEntryToForm(fishType) {
                // Add to main form
                const fishEntries = document.querySelectorAll('.fish-entry');
                if (fishEntries.length >= 3) return;
                
                const fishNumber = fishEntries.length + 1;
                const fishId = `fish-${fishNumber}`;
                const fishEntry = document.createElement('div');
                fishEntry.className = 'fish-entry';
                fishEntry.id = fishId;
                fishEntry.innerHTML = `
                    <button class="remove-fish-btn" data-fish-id="${fishId}"><i class="fas fa-times"></i></button>
                    <h3 class="font-semibold text-blue-700 mb-3">Fish #${fishNumber}</h3>
                    <div class="mb-4 bg-gray-50 p-3 rounded-lg">
                        <h4 class="font-medium text-sm mb-2 text-gray-700">Fish Type</h4>
                        <select class="fish-type w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="mechPacker10_3_4">10-3/4" Mechanical Packer</option>
                            <option value="mechPacker9_5_8">9-5/8" Mechanical Packer</option>
                            <option value="mechPacker7">7" Mechanical Packer</option>
                            <option value="cpa9_5_8">9-5/8" CPA Assembly</option>
                            <option value="cpa7">7" CPA Assembly</option>
                            <option value="tubingHanger">7" Tubing Hanger</option>
                            <option value="espTubing">ESP</option>
                            <option value="pump">Pump</option>
                            <option value="cibp">CIBP</option>
                            <option value="tubular">Tubular</option>
                            <option value="tubularCemented">Tubular Cemented</option>
                            <option value="drillingBHA">Drilling BHA</option>
                            <option value="loggingTool">Logging Tool</option>
                            <option value="liner4">4" Liner</option>
                            <option value="liner5_1_2">5-1/2" Liner</option>
                            <option value="liner6_5_8">6-5/8" Liner</option>
                            <option value="casing">Casing</option>
                            <option value="dc">DC</option>
                            <option value="bullplug">Bullplug</option>
                            <option value="cone">Cone</option>
                            <option value="sandBailer">Sand Bailer</option>
                            <option value="sinkerBar">Sinker Bar</option>
                            <option value="junks">Junks (others)</option>
                        </select>
                    </div>
                `;
                
                document.getElementById('fishEntriesContainer').appendChild(fishEntry);
                
                // Set the fish type
                const select = fishEntry.querySelector('.fish-type');
                select.value = fishType;
                
                // Add event listeners
                fishEntry.querySelector('.remove-fish-btn').addEventListener('click', function () {
                    removeFishEntry(this.getAttribute('data-fish-id'));
                });
                
                select.addEventListener('change', function () {
                    updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                    recommendFishingTools();
                    historicalWellManager.updateAIDisplay();
                });
                
                // Update AI display
                this.updateAIDisplay();
                
                return fishId;
            }

            deleteWell(wellId) {
                if (confirm('Are you sure you want to delete this well from history?')) {
                    this.wells = this.wells.filter(w => w.id !== wellId);
                    this.saveWells();
                }
            }

            renderWells() {
                const container = document.getElementById('historicalWellsContainer');
                const noWellsMessage = document.getElementById('noWellsMessage');
                
                if (this.wells.length === 0) {
                    container.innerHTML = '';
                    noWellsMessage.classList.remove('hidden');
                    return;
                }

                noWellsMessage.classList.add('hidden');
                
                container.innerHTML = this.wells.map(well => `
                    <div class="well-card ${this.currentSelectedWell?.id === well.id ? 'selected' : ''}" data-well-id="${well.id}">
                        <div class="flex justify-between items-start mb-2">
                            <h5 class="font-bold text-blue-800">${well.wellName}</h5>
                            <span class="well-status-badge ${well.isFirstEntry === 'yes' ? 'status-warning' : 'status-success'}">
                                ${well.isFirstEntry === 'yes' ? 'First Entry' : 'Subsequent'}
                            </span>
                        </div>
                        <div class="text-sm text-gray-600 mb-3">
                            <div class="flex justify-between mb-1">
                                <span>Field:</span>
                                <span class="font-medium">${well.fieldName}</span>
                            </div>
                            <div class="flex justify-between mb-1">
                                <span>Saved:</span>
                                <span>${new Date(well.savedDate).toLocaleDateString()}</span>
                            </div>
                            <div class="flex justify-between mb-1">
                                <span>Fish Entries:</span>
                                <span>${well.fishEntries ? well.fishEntries.length : 0}</span>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <button class="load-well-btn text-sm bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg" data-well-id="${well.id}">
                                <i class="fas fa-upload mr-1"></i> Load
                            </button>
                            <button class="delete-well-btn text-sm bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg" data-well-id="${well.id}">
                                <i class="fas fa-trash-alt mr-1"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');

                // Add event listeners
                document.querySelectorAll('.load-well-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const wellId = parseInt(btn.getAttribute('data-well-id'));
                        this.loadWellData(wellId);
                        this.renderWells();
                    });
                });

                document.querySelectorAll('.delete-well-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const wellId = parseInt(btn.getAttribute('data-well-id'));
                        this.deleteWell(wellId);
                    });
                });

                document.querySelectorAll('.well-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('load-well-btn') && 
                            !e.target.classList.contains('delete-well-btn') &&
                            !e.target.closest('.load-well-btn') &&
                            !e.target.closest('.delete-well-btn')) {
                            const wellId = parseInt(card.getAttribute('data-well-id'));
                            this.loadWellData(wellId);
                            this.renderWells();
                        }
                    });
                });
            }
            
            updateAIDisplay() {
                // Update well info in AI tab
                const wellName = document.getElementById('wellName').value;
                const fieldName = document.getElementById('fieldName').value;
                const firstEntry = document.getElementById('firstEntry').value;
                const fishEntries = document.querySelectorAll('.fish-entry');
                
                document.getElementById('aiWellName').textContent = wellName || '--';
                document.getElementById('aiFieldName').textContent = fieldName || '--';
                document.getElementById('aiEntryType').textContent = firstEntry === 'yes' ? 'First Entry' : 'Subsequent Entry';
                document.getElementById('aiFishCount').textContent = fishEntries.length;
                
                // Update fish entries display in AI tab
                this.updateAIFishEntries();
            }
            
            updateAIFishEntries() {
                const aiFishContainer = document.getElementById('aiFishEntriesContainer');
                const noFishAI = document.getElementById('noFishAI');
                
                if (!aiFishContainer) return;
                
                const fishEntries = document.querySelectorAll('.fish-entry');
                
                if (fishEntries.length === 0) {
                    aiFishContainer.innerHTML = '';
                    if (noFishAI) noFishAI.classList.remove('hidden');
                    return;
                }
                
                if (noFishAI) noFishAI.classList.add('hidden');
                
                aiFishContainer.innerHTML = '';
                
                fishEntries.forEach((entry, index) => {
                    const fishType = entry.querySelector('.fish-type').value;
                    const fishNumber = index + 1;
                    
                    const fishDisplay = document.createElement('div');
                    fishDisplay.className = 'ai-fish-entry p-4 bg-white rounded-lg border border-blue-200 shadow-sm hover:shadow-md transition-all duration-300';
                    fishDisplay.innerHTML = `
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-fish text-blue-500"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-blue-800">Fish #${fishNumber}</div>
                                    <div class="text-xs text-gray-500">Click to edit fish type</div>
                                </div>
                            </div>
                            <button class="remove-ai-fish-btn text-red-600 hover:text-red-800 hover:scale-110 transition-transform" data-fish-id="${entry.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Fish Type</label>
                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-300 fish-type-clickable" id="ai-fish-type-display-${entry.id}">
                                <div class="font-medium text-blue-800">${this.getFishTypeName(fishType)}</div>
                                <div class="text-xs text-gray-600 mt-1">Click to change</div>
                            </div>
                        </div>
                        
                        <div class="fish-type-selector hidden mt-3" id="fish-type-selector-${entry.id}">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select New Fish Type</label>
                            <select class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ai-fish-type-select" data-fish-id="${entry.id}">
                                <option value="mechPacker10_3_4">10-3/4" Mechanical Packer</option>
                                <option value="mechPacker9_5_8">9-5/8" Mechanical Packer</option>
                                <option value="mechPacker7">7" Mechanical Packer</option>
                                <option value="cpa9_5_8">9-5/8" CPA Assembly</option>
                                <option value="cpa7">7" CPA Assembly</option>
                                <option value="tubingHanger">7" Tubing Hanger</option>
                                <option value="espTubing">ESP</option>
                                <option value="pump">Pump</option>
                                <option value="cibp">CIBP</option>
                                <option value="tubular">Tubular</option>
                                <option value="tubularCemented">Tubular Cemented</option>
                                <option value="drillingBHA">Drilling BHA</option>
                                <option value="loggingTool">Logging Tool</option>
                                <option value="liner4">4" Liner</option>
                                <option value="liner5_1_2">5-1/2" Liner</option>
                                <option value="liner6_5_8">6-5/8" Liner</option>
                                <option value="casing">Casing</option>
                                <option value="dc">DC</option>
                                <option value="bullplug">Bullplug</option>
                                <option value="cone">Cone</option>
                                <option value="sandBailer">Sand Bailer</option>
                                <option value="sinkerBar">Sinker Bar</option>
                                <option value="junks">Junks (others)</option>
                            </select>
                            <div class="flex gap-2 mt-3">
                                <button class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm save-fish-type-btn" data-fish-id="${entry.id}">
                                    <i class="fas fa-check mr-1"></i> Save
                                </button>
                                <button class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg text-sm cancel-fish-type-btn" data-fish-id="${entry.id}">
                                    <i class="fas fa-times mr-1"></i> Cancel
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-xs text-gray-500 border-t pt-3 mt-3">
                            <i class="fas fa-info-circle mr-1"></i>
                            <span class="font-medium">Impact:</span> 
                            <span id="ai-fish-impact-${entry.id}">${this.getFishImpactDescription(fishType)}</span>
                        </div>
                    `;
                    
                    aiFishContainer.appendChild(fishDisplay);
                    
                    // Set current value in selector
                    const selectElement = fishDisplay.querySelector(`.ai-fish-type-select[data-fish-id="${entry.id}"]`);
                    if (selectElement) {
                        selectElement.value = fishType;
                    }
                    
                    // Add event listeners
                    
                    // Remove fish button
                    fishDisplay.querySelector('.remove-ai-fish-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeFishEntry(entry.id);
                    });
                    
                    // Fish type display click to show selector
                    const displayDiv = fishDisplay.querySelector(`#ai-fish-type-display-${entry.id}`);
                    const selectorDiv = fishDisplay.querySelector(`#fish-type-selector-${entry.id}`);
                    
                    if (displayDiv && selectorDiv) {
                        displayDiv.addEventListener('click', () => {
                            fishDisplay.classList.add('editing');
                            selectorDiv.classList.remove('hidden');
                            displayDiv.classList.add('hidden');
                        });
                    }
                    
                    // Save fish type button
                    const saveBtn = fishDisplay.querySelector(`.save-fish-type-btn[data-fish-id="${entry.id}"]`);
                    if (saveBtn) {
                        saveBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const newFishType = selectElement.value;
                            this.changeFishType(entry.id, newFishType);
                            
                            // Hide selector, show display
                            fishDisplay.classList.remove('editing');
                            selectorDiv.classList.add('hidden');
                            displayDiv.classList.remove('hidden');
                            
                            // Update impact description
                            const impactElement = fishDisplay.querySelector(`#ai-fish-impact-${entry.id}`);
                            if (impactElement) {
                                impactElement.textContent = this.getFishImpactDescription(newFishType);
                            }
                        });
                    }
                    
                    // Cancel fish type button
                    const cancelBtn = fishDisplay.querySelector(`.cancel-fish-type-btn[data-fish-id="${entry.id}"]`);
                    if (cancelBtn) {
                        cancelBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            fishDisplay.classList.remove('editing');
                            selectorDiv.classList.add('hidden');
                            displayDiv.classList.remove('hidden');
                        });
                    }
                });
            }
            
            // NEW METHOD: Add fish entry directly from AI tab
            addFishEntryInAITab() {
                // Check if we can add more fish (max 3)
                const fishEntries = document.querySelectorAll('.fish-entry');
                if (fishEntries.length >= 3) {
                    alert('Maximum 3 fish entries allowed');
                    return;
                }
                
                // Add fish entry to main form
                const fishNumber = fishEntries.length + 1;
                const fishId = `fish-${fishNumber}`;
                const fishEntry = document.createElement('div');
                fishEntry.className = 'fish-entry';
                fishEntry.id = fishId;
                fishEntry.innerHTML = `
                    <button class="remove-fish-btn" data-fish-id="${fishId}"><i class="fas fa-times"></i></button>
                    <h3 class="font-semibold text-blue-700 mb-3">Fish #${fishNumber}</h3>
                    <div class="mb-4 bg-gray-50 p-3 rounded-lg">
                        <h4 class="font-medium text-sm mb-2 text-gray-700">Fish Type</h4>
                        <select class="fish-type w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="mechPacker10_3_4">10-3/4" Mechanical Packer</option>
                            <option value="mechPacker9_5_8">9-5/8" Mechanical Packer</option>
                            <option value="mechPacker7">7" Mechanical Packer</option>
                            <option value="cpa9_5_8">9-5/8" CPA Assembly</option>
                            <option value="cpa7">7" CPA Assembly</option>
                            <option value="tubingHanger">7" Tubing Hanger</option>
                            <option value="espTubing">ESP</option>
                            <option value="pump">Pump</option>
                            <option value="cibp">CIBP</option>
                            <option value="tubular">Tubular</option>
                            <option value="tubularCemented">Tubular Cemented</option>
                            <option value="drillingBHA">Drilling BHA</option>
                            <option value="loggingTool">Logging Tool</option>
                            <option value="liner4">4" Liner</option>
                            <option value="liner5_1_2">5-1/2" Liner</option>
                            <option value="liner6_5_8">6-5/8" Liner</option>
                            <option value="casing">Casing</option>
                            <option value="dc">DC</option>
                            <option value="bullplug">Bullplug</option>
                            <option value="cone">Cone</option>
                            <option value="sandBailer">Sand Bailer</option>
                            <option value="sinkerBar">Sinker Bar</option>
                            <option value="junks">Junks (others)</option>
                        </select>
                    </div>
                `;
                
                document.getElementById('fishEntriesContainer').appendChild(fishEntry);
                
                // Set default value
                const select = fishEntry.querySelector('.fish-type');
                select.value = 'tubular';
                
                // Add event listeners
                fishEntry.querySelector('.remove-fish-btn').addEventListener('click', function () {
                    removeFishEntry(this.getAttribute('data-fish-id'));
                });
                
                select.addEventListener('change', function () {
                    updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                    recommendFishingTools();
                    historicalWellManager.updateAIDisplay();
                });
                
                // Update AI display
                this.updateAIDisplay();
                
                // Trigger calculations
                updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                recommendFishingTools();
                
                return fishId;
            }
            
            changeFishType(fishId, newFishType) {
                // Find the fish entry in main form
                const fishEntry = document.getElementById(fishId);
                if (!fishEntry) return;
                
                // Update the select in main form
                const select = fishEntry.querySelector('.fish-type');
                if (select) {
                    select.value = newFishType;
                    
                    // Trigger change event
                    select.dispatchEvent(new Event('change'));
                }
                
                // Update display name in the AI tab
                const displayElement = document.querySelector(`#ai-fish-type-display-${fishId} .font-medium`);
                if (displayElement) {
                    displayElement.textContent = this.getFishTypeName(newFishType);
                }
                
                // Update impact description
                const impactElement = document.querySelector(`#ai-fish-impact-${fishId}`);
                if (impactElement) {
                    impactElement.textContent = this.getFishImpactDescription(newFishType);
                }
                
                // Trigger all calculations
                updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                recommendFishingTools();
            }
            
            getFishTypeName(fishType) {
                const fishTypeNames = {
                    'mechPacker10_3_4': '10-3/4" Mechanical Packer',
                    'mechPacker9_5_8': '9-5/8" Mechanical Packer',
                    'mechPacker7': '7" Mechanical Packer',
                    'cpa9_5_8': '9-5/8" CPA Assembly',
                    'cpa7': '7" CPA Assembly',
                    'tubingHanger': '7" Tubing Hanger',
                    'espTubing': 'ESP',
                    'pump': 'Pump',
                    'cibp': 'CIBP',
                    'tubular': 'Tubular',
                    'tubularCemented': 'Tubular Cemented',
                    'drillingBHA': 'Drilling BHA',
                    'loggingTool': 'Logging Tool',
                    'liner4': '4" Liner',
                    'liner5_1_2': '5-1/2" Liner',
                    'liner6_5_8': '6-5/8" Liner',
                    'casing': 'Casing',
                    'dc': 'DC',
                    'bullplug': 'Bullplug',
                    'cone': 'Cone',
                    'sandBailer': 'Sand Bailer',
                    'sinkerBar': 'Sinker Bar',
                    'junks': 'Junks (others)'
                };
                
                return fishTypeNames[fishType] || 'Unknown Fish Type';
            }
            
            getFishImpactDescription(fishType) {
                const fishData = getFishTypeData(fishType);
                if (!fishData) return "No impact data available";
                
                const successRatePercent = (fishData.successRate * 100).toFixed(0);
                const impactLevel = fishData.successRate >= 0.9 ? 'High Success' :
                                   fishData.successRate >= 0.7 ? 'Medium Success' : 'Challenging';
                
                return `Time: ${fishData.days} days, Cost: $${fishData.dailyCost.toFixed(0)}/day, Success: ${successRatePercent}% (${impactLevel})`;
            }
            
            updateAIStats() {
                // Update the AI stats display
                document.getElementById('aiWellCount').textContent = this.wells.length;
            }
        }

        // =============================================
        // HSSE RISK CALCULATOR WITH OVERPULL CALCULATION
        // =============================================
        class HSSERiskCalculator {
            constructor() {
                this.riskMatrix = {
                    1: { 1: 'LOW', 2: 'LOW', 3: 'MEDIUM', 4: 'HIGH', 5: 'HIGH' },
                    2: { 1: 'LOW', 2: 'MEDIUM', 3: 'HIGH', 4: 'HIGH', 5: 'EXTREME' },
                    3: { 1: 'MEDIUM', 2: 'HIGH', 3: 'HIGH', 4: 'EXTREME', 5: 'EXTREME' },
                    4: { 1: 'HIGH', 2: 'HIGH', 3: 'EXTREME', 4: 'EXTREME', 5: 'EXTREME' }
                };

                this.riskActions = {
                    'LOW': {
                        color: 'bg-green-100 text-green-800',
                        icon: 'fa-check-circle',
                        message: 'Risk Acceptable',
                        actions: ['Proceed with normal controls', 'Monitor during operations']
                    },
                    'MEDIUM': {
                        color: 'bg-yellow-100 text-yellow-800',
                        icon: 'fa-exclamation-triangle',
                        message: 'Risk Requires Control',
                        actions: ['Implement additional controls', 'Increase monitoring frequency']
                    },
                    'HIGH': {
                        color: 'bg-orange-100 text-orange-800',
                        icon: 'fa-exclamation-circle',
                        message: 'High Risk - Review Required',
                        actions: ['Senior management review required', 'Implement risk reduction measures']
                    },
                    'EXTREME': {
                        color: 'bg-red-100 text-red-800',
                        icon: 'fa-times-circle',
                        message: 'Extreme Risk - Stop Work',
                        actions: ['Immediate action required', 'Work cannot proceed until risk reduced']
                    }
                };
                
                // Tubular yield strength data (tons)
                this.tubularData = {
                    '2_7_8': { yieldStrength: 110, description: '2-7/8" Tubing' },
                    '3_1_2': { yieldStrength: 150, description: '3-1/2" Tubing' },
                    '4_1_2': { yieldStrength: 220, description: '4-1/2" Drill Pipe' },
                    '5': { yieldStrength: 280, description: '5" Drill Pipe' },
                    '5_1_2': { yieldStrength: 350, description: '5-1/2" Drill Pipe' },
                    '6_5_8': { yieldStrength: 420, description: '6-5/8" Drill Pipe' }
                };
            }

            calculateRisk() {
                const severity = parseInt(document.getElementById('severitySelect').value);
                const probability = parseInt(document.getElementById('probabilitySelect').value);
                
                if (!severity || !probability) {
                    alert('Please select both severity and probability.');
                    return;
                }

                const riskLevel = this.riskMatrix[severity][probability];
                const riskInfo = this.riskActions[riskLevel];

                const resultDiv = document.getElementById('riskResult');
                resultDiv.innerHTML = `
                    <div class="${riskInfo.color} p-3 rounded-lg">
                        <div class="flex items-center justify-center gap-2 mb-2">
                            <i class="fas ${riskInfo.icon}"></i>
                            <div class="font-bold text-lg">${riskLevel} RISK</div>
                        </div>
                        <div class="font-medium mb-2">${riskInfo.message}</div>
                        <div class="text-left">
                            <div class="font-medium text-xs mb-1">Required Actions:</div>
                            <ul class="list-disc list-inside text-xs">
                                ${riskInfo.actions.map(action => `<li>${action}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                resultDiv.classList.remove('hidden');
            }
            
            calculateOverpullRisk() {
                const rigCapacity = parseFloat(document.getElementById('rigCapacity').value);
                const tubularType = document.getElementById('tubularType').value;
                const fishWeight = parseFloat(document.getElementById('fishWeight').value) || 0;
                const safetyFactor = parseFloat(document.getElementById('safetyFactor').value);
                const fishAge = parseFloat(document.getElementById('fishAge').value) || 1.0;
                const riskTolerance = parseFloat(document.getElementById('riskTolerance').value) || 0.8;
                
                if (!rigCapacity || !tubularType) {
                    alert('Please select rig capacity and tubular type.');
                    return;
                }
                
                const tubular = this.tubularData[tubularType];
                const tubularYield = tubular.yieldStrength;
                
                // Adjust tubular yield based on fish age (corrosion factor)
                const adjustedTubularYield = tubularYield / fishAge;
                
                // Calculate maximum safe pull (limited by rig capacity and tubular yield)
                const maxByRig = rigCapacity * riskTolerance; // Use risk tolerance factor
                const maxByTubular = adjustedTubularYield / safetyFactor;
                const maxSafePull = Math.min(maxByRig, maxByTubular);
                
                // Calculate required pull (fish weight + safety margin)
                const requiredPull = fishWeight * 1.3; // 30% additional for safety
                
                // Calculate risk percentage
                let riskPercentage = (requiredPull / maxSafePull) * 100;
                riskPercentage = Math.min(100, Math.max(0, riskPercentage));
                
                // Determine risk level
                let riskLevel, riskColor, riskBarColor;
                if (riskPercentage <= 60) {
                    riskLevel = 'LOW RISK';
                    riskColor = 'text-green-600';
                    riskBarColor = 'bg-green-500';
                } else if (riskPercentage <= 80) {
                    riskLevel = 'MEDIUM RISK';
                    riskColor = 'text-yellow-600';
                    riskBarColor = 'bg-yellow-500';
                } else if (riskPercentage <= 95) {
                    riskLevel = 'HIGH RISK';
                    riskColor = 'text-orange-600';
                    riskBarColor = 'bg-orange-500';
                } else {
                    riskLevel = 'CRITICAL RISK';
                    riskColor = 'text-red-600';
                    riskBarColor = 'bg-red-500';
                }
                
                // Update display
                document.getElementById('maxSafePull').textContent = `${maxSafePull.toFixed(1)} tons`;
                document.getElementById('tubularYield').textContent = `${adjustedTubularYield.toFixed(0)} tons`;
                document.getElementById('overpullRiskLevel').innerHTML = `<span class="${riskColor}">${riskLevel}</span>`;
                
                const riskBar = document.getElementById('overpullRiskBar');
                riskBar.style.width = `${riskPercentage}%`;
                riskBar.className = `h-4 rounded-full transition-all duration-1000 ${riskBarColor}`;
                
                // Generate recommendations
                const recommendations = this.generateOverpullRecommendations(
                    riskPercentage, 
                    maxSafePull, 
                    requiredPull, 
                    rigCapacity, 
                    adjustedTubularYield,
                    fishAge
                );
                
                document.getElementById('overpullRecommendations').innerHTML = recommendations;
                document.getElementById('overpullResult').classList.remove('hidden');
            }
            
            generateOverpullRecommendations(riskPercentage, maxSafePull, requiredPull, rigCapacity, tubularYield, fishAge) {
                let recommendations = '';
                
                // Add fish age warning if applicable
                if (fishAge > 1.0) {
                    recommendations += `
                        <div class="mb-3 p-2 bg-orange-100 rounded border border-orange-200">
                            <div class="font-medium text-orange-800">‚ö† FISH AGE CONSIDERATION</div>
                            <div class="text-xs text-orange-700">
                                <p>Fish has been in well for ${fishAge === 1.2 ? '2-5 years' : 'more than 5 years'}. Tubular strength reduced by ${Math.round((fishAge - 1) * 100)}% due to potential corrosion.</p>
                                <p class="mt-1">Consider higher safety factors for aged tubulars.</p>
                            </div>
                        </div>
                    `;
                }
                
                if (riskPercentage <= 60) {
                    recommendations += `
                        <div class="p-2 bg-green-100 rounded border border-green-200">
                            <div class="font-medium text-green-800">‚úì SAFE OPERATING WINDOW</div>
                            <div class="text-xs text-green-700">
                                <p>Required pull (${requiredPull.toFixed(1)} tons) is well below maximum safe pull (${maxSafePull.toFixed(1)} tons).</p>
                                <p class="mt-1">Recommendations:</p>
                                <ul class="list-disc list-inside ml-2">
                                    <li>Proceed with fishing operation</li>
                                    <li>Monitor hook load continuously</li>
                                    <li>Stop if pull approaches ${(maxSafePull * 0.8).toFixed(1)} tons</li>
                                </ul>
                            </div>
                        </div>
                    `;
                } else if (riskPercentage <= 80) {
                    recommendations += `
                        <div class="p-2 bg-yellow-100 rounded border border-yellow-200">
                            <div class="font-medium text-yellow-800">‚ö† CAUTION REQUIRED</div>
                            <div class="text-xs text-yellow-700">
                                <p>Required pull (${requiredPull.toFixed(1)} tons) is ${riskPercentage.toFixed(0)}% of maximum safe pull.</p>
                                <p class="mt-1">Recommendations:</p>
                                <ul class="list-disc list-inside ml-2">
                                    <li>Review fishing strategy</li>
                                    <li>Consider using heavier tubulars</li>
                                    <li>Have contingency plans ready</li>
                                    <li>Increase monitoring frequency</li>
                                </ul>
                            </div>
                        </div>
                    `;
                } else if (riskPercentage <= 95) {
                    recommendations += `
                        <div class="p-2 bg-orange-100 rounded border border-orange-200">
                            <div class="font-medium text-orange-800">‚ö† HIGH RISK - REVIEW REQUIRED</div>
                            <div class="text-xs text-orange-700">
                                <p>Required pull (${requiredPull.toFixed(1)} tons) is ${riskPercentage.toFixed(0)}% of maximum safe pull.</p>
                                <p class="mt-1">Immediate Actions Required:</p>
                                <ul class="list-disc list-inside ml-2">
                                    <li>Senior management review mandatory</li>
                                    <li>Consider alternative fishing methods</li>
                                    <li>Upgrade to stronger tubulars</li>
                                    <li>Implement additional safety measures</li>
                                </ul>
                            </div>
                        </div>
                    `;
                } else {
                    recommendations += `
                        <div class="p-2 bg-red-100 rounded border border-red-200">
                            <div class="font-medium text-red-800">‚úó CRITICAL RISK - DO NOT PROCEED</div>
                            <div class="text-xs text-red-700">
                                <p>Required pull (${requiredPull.toFixed(1)} tons) exceeds maximum safe pull (${maxSafePull.toFixed(1)} tons).</p>
                                <p class="mt-1">Required Actions:</p>
                                <ul class="list-disc list-inside ml-2">
                                    <li>STOP WORK IMMEDIATELY</li>
                                    <li>Re-evaluate entire fishing plan</li>
                                    <li>Consider sidetrack or abandonment</li>
                                    <li>Consult with engineering team</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
                // Add general recommendations
                recommendations += `
                    <div class="mt-2 p-2 bg-blue-50 rounded border border-blue-200 text-xs">
                        <div class="font-medium text-blue-800">General Safety Guidelines:</div>
                        <ul class="list-disc list-inside ml-2">
                            <li>Never exceed ${(document.getElementById('riskTolerance').value * 100).toFixed(0)}% of rig derrick capacity</li>
                            <li>Apply safety factor of ${document.getElementById('safetyFactor').value} for fishing operations</li>
                            <li>Monitor tubular wear and corrosion regularly</li>
                            <li>Have backup tubulars and tools available</li>
                            <li>Consider fish age when calculating tubular strength</li>
                        </ul>
                    </div>
                `;
                
                return recommendations;
            }
        }

        // =============================================
        // ENHANCED AI EXPERT SYSTEM
        // =============================================
        class EnhancedFishingAI {
            constructor() {
                this.analysisHistory = [];
                this.loadHistory();
            }
            
            loadHistory() {
                const saved = localStorage.getItem('aiAnalysisHistory');
                this.analysisHistory = saved ? JSON.parse(saved) : [];
            }
            
            saveHistory() {
                localStorage.setItem('aiAnalysisHistory', JSON.stringify(this.analysisHistory));
            }
            
            async analyzeCurrentWell() {
                // Check if fish entries exist in either main form or AI display
                const fishEntriesMain = document.querySelectorAll('.fish-entry');
                const aiFishContainer = document.getElementById('aiFishEntriesContainer');
                const hasFishInAI = aiFishContainer && !aiFishContainer.querySelector('#noFishAI:not(.hidden)');
                
                if (fishEntriesMain.length === 0 && !hasFishInAI) {
                    throw new Error('Please add at least one fish entry before running AI analysis. You can add fish entries directly in this AI tab.');
                }
                
                // Get current well data
                const wellData = getCurrentWellData();
                const fishTypes = Array.from(fishEntriesMain).map(entry => 
                    entry.querySelector('.fish-type').value
                );
                
                // Show thinking process
                document.getElementById('aiThinkingProcess').classList.remove('hidden');
                document.getElementById('aiResults').classList.add('hidden');
                
                // Simulate AI processing delay
                await this.simulateThinking();
                
                // Calculate actual results (same as main calculator)
                const isFirstEntry = wellData.firstEntry === 'yes';
                const totalTimeEstimate = getTotalTimeEstimate();
                const totalCostEstimate = getTotalCostEstimate();
                
                let successRate, eft, costEstimate, cycleTime;
                
                if (isFirstEntry) {
                    successRate = parseFloat(calculateFishingProbability());
                    const probabilityValue = successRate / 100;
                    costEstimate = totalCostEstimate * probabilityValue;
                    cycleTime = totalTimeEstimate * probabilityValue;
                    eft = calculateEFT(totalTimeEstimate, totalCostEstimate);
                } else {
                    successRate = parseFloat(calculateFishingSuccessRate());
                    costEstimate = totalCostEstimate;
                    cycleTime = totalTimeEstimate;
                    eft = calculateEFT(totalTimeEstimate, totalCostEstimate);
                }
                
                // Calculate additional AI metrics
                const casingScore = this.calculateCasingScore();
                const accessScore = this.calculateAccessScore();
                const viabilityScore = this.calculateViabilityScore(successRate, eft, cycleTime);
                
                // Generate recommendations
                const recommendations = this.generateRecommendations(
                    successRate, 
                    eft, 
                    cycleTime, 
                    casingScore, 
                    accessScore
                );
                
                const risks = this.identifyRisks(casingScore, accessScore);
                
                // Build result object
                const result = {
                    timestamp: new Date().toISOString(),
                    wellName: wellData.wellName || 'Unnamed Well',
                    successRate,
                    eft,
                    costEstimate,
                    cycleTime,
                    casingScore,
                    accessScore,
                    viabilityScore,
                    recommendations,
                    risks,
                    confidence: this.calculateConfidence(wellData, fishTypes),
                    isFirstEntry
                };
                
                // Save to history
                this.analysisHistory.push(result);
                this.saveHistory();
                
                // Update stats
                this.updateStats();
                
                // Display results
                this.displayResults(result);
                
                return result;
            }
            
            simulateThinking() {
                return new Promise(resolve => {
                    // Animate progress bars
                    this.animateProgressBar('aiCasingBar', 75);
                    this.animateProgressBar('aiAccessBar', 60);
                    
                    setTimeout(() => {
                        resolve();
                    }, 2000);
                });
            }
            
            animateProgressBar(elementId, targetPercentage) {
                const bar = document.getElementById(elementId);
                if (!bar) return;
                
                let current = 0;
                const increment = targetPercentage / 100;
                const interval = setInterval(() => {
                    if (current >= targetPercentage) {
                        clearInterval(interval);
                        return;
                    }
                    current += increment;
                    bar.style.width = `${current}%`;
                    bar.className = `h-2 rounded-full transition-all duration-1000 ${
                        current < 30 ? 'bg-red-500' :
                        current < 60 ? 'bg-yellow-500' :
                        current < 80 ? 'bg-blue-500' : 'bg-green-500'
                    }`;
                    
                    // Update score text
                    const scoreElement = document.getElementById(elementId.replace('Bar', 'Score'));
                    if (scoreElement) {
                        scoreElement.textContent = `${Math.round(current)}%`;
                        scoreElement.className = `text-xs px-2 py-1 rounded-full ${
                            current < 30 ? 'bg-red-100 text-red-700' :
                            current < 60 ? 'bg-yellow-100 text-yellow-700' :
                            current < 80 ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700'
                        }`;
                    }
                }, 20);
            }
            
            calculateCasingScore() {
                const casingParted = parseFloat(document.getElementById('casingPartedCollapse').value) || 1;
                const casingDamage = parseFloat(document.getElementById('casingDamage').value) || 1;
                
                if (casingParted === 0 || casingDamage === 0) return 10;
                if (casingParted === 0.2 || casingDamage === 0.57) return 40;
                return 85;
            }
            
            calculateAccessScore() {
                const tofCondition = parseFloat(document.getElementById('tofCondition').value) || 1;
                const fishDetail = parseFloat(document.getElementById('fishDetailCondition').value) || 1;
                const wellGeometry = document.getElementById('firstEntry').value === 'yes' ? 
                    parseFloat(document.getElementById('wellGeometry').value) || 0.01 :
                    parseFloat(document.getElementById('wellGeometrySuccess').value) || 1;
                
                let score = 70;
                if (tofCondition === 0.8) score -= 30;
                if (tofCondition === 0.85) score -= 15;
                if (fishDetail === 0.85) score -= 20;
                if (wellGeometry === 0.03 || wellGeometry === 0.9) score -= 25;
                
                return Math.max(10, Math.min(100, score));
            }
            
            calculateViabilityScore(successRate, eft, cycleTime) {
                let score = successRate; // Base score from success rate
                
                // Adjust based on economic viability
                if (cycleTime < eft) score += 20;
                else if (cycleTime < eft * 1.5) score += 5;
                else score -= 30;
                
                // Adjust based on casing and access scores
                const casingScore = this.calculateCasingScore();
                const accessScore = this.calculateAccessScore();
                
                score += (casingScore + accessScore) / 20;
                
                return Math.max(0, Math.min(100, Math.round(score)));
            }
            
            generateRecommendations(successRate, eft, cycleTime, casingScore, accessScore) {
                const recommendations = [];
                
                // Success-based recommendations
                if (successRate >= 70) {
                    recommendations.push({
                        type: 'success',
                        icon: 'fa-check-circle',
                        color: 'text-green-600',
                        bgColor: 'bg-green-50',
                        title: 'HIGH VIABILITY',
                        message: 'This operation has excellent success potential based on historical data'
                    });
                } else if (successRate >= 50) {
                    recommendations.push({
                        type: 'caution',
                        icon: 'fa-exclamation-triangle',
                        color: 'text-yellow-600',
                        bgColor: 'bg-yellow-50',
                        title: 'MODERATE VIABILITY',
                        message: 'Proceed with caution and ensure contingency plans are in place'
                    });
                } else {
                    recommendations.push({
                        type: 'warning',
                        icon: 'fa-times-circle',
                        color: 'text-red-600',
                        bgColor: 'bg-red-50',
                        title: 'HIGH RISK',
                        message: 'Consider alternative approaches or detailed risk mitigation'
                    });
                }
                
                // Economic recommendations
                if (cycleTime < eft) {
                    recommendations.push({
                        type: 'economic',
                        icon: 'fa-chart-line',
                        color: 'text-blue-600',
                        bgColor: 'bg-blue-50',
                        title: 'ECONOMICALLY FAVORABLE',
                        message: `Operation can be completed in ${cycleTime.toFixed(1)} days vs ${eft.toFixed(1)} economic limit`
                    });
                } else {
                    recommendations.push({
                        type: 'economic',
                        icon: 'fa-exclamation-circle',
                        color: 'text-orange-600',
                        bgColor: 'bg-orange-50',
                        title: 'ECONOMIC CONCERN',
                        message: `Cycle time exceeds economic limit by ${(cycleTime - eft).toFixed(1)} days`
                    });
                }
                
                // Casing recommendations
                if (casingScore < 40) {
                    recommendations.push({
                        type: 'technical',
                        icon: 'fa-hard-hat',
                        color: 'text-red-600',
                        bgColor: 'bg-red-50',
                        title: 'CASING INTEGRITY ISSUE',
                        message: 'Severe casing damage detected. Consider repair before fishing'
                    });
                } else if (casingScore < 70) {
                    recommendations.push({
                        type: 'technical',
                        icon: 'fa-tools',
                        color: 'text-yellow-600',
                        bgColor: 'bg-yellow-50',
                        title: 'CASING CONDITIONAL',
                        message: 'Moderate casing concerns. Use specialized tools and approach carefully'
                    });
                }
                
                // Accessibility recommendations
                if (accessScore < 50) {
                    recommendations.push({
                        type: 'technical',
                        icon: 'fa-compress-arrows-alt',
                        color: 'text-purple-600',
                        bgColor: 'bg-purple-50',
                        title: 'ACCESS CHALLENGE',
                        message: 'Limited access to fish. Consider multiple preparation runs'
                    });
                }
                
                return recommendations;
            }
            
            identifyRisks(casingScore, accessScore) {
                const risks = [];
                
                if (casingScore < 30) {
                    risks.push({
                        severity: 'critical',
                        message: 'Critical casing damage may prevent fishing entirely',
                        mitigation: 'Consider casing repair or sidetrack options'
                    });
                }
                
                if (accessScore < 40) {
                    risks.push({
                        severity: 'high',
                        message: 'Poor fish accessibility increases operation complexity',
                        mitigation: 'Use advanced fishing tools and allow extra time'
                    });
                }
                
                const fishingType = document.getElementById('fishingType').value;
                if (fishingType === '0,8') {
                    risks.push({
                        severity: 'medium',
                        message: 'Open hole fishing carries additional risks',
                        mitigation: 'Implement strict hole cleaning and monitoring procedures'
                    });
                }
                
                return risks;
            }
            
            calculateConfidence(wellData, fishTypes) {
                let confidence = 0.8;
                
                // Increase confidence with complete data
                if (wellData.wellName && wellData.fieldName) confidence += 0.1;
                if (fishTypes.length > 0) confidence += 0.05;
                if (document.getElementById('fishDetailCondition').value === '1') confidence += 0.05;
                
                // Decrease confidence with critical issues
                if (this.calculateCasingScore() < 30) confidence -= 0.2;
                if (this.calculateAccessScore() < 30) confidence -= 0.15;
                
                return Math.max(0.5, Math.min(0.95, confidence));
            }
            
            updateStats() {
                const wellCount = this.analysisHistory.length;
                document.getElementById('aiWellCount').textContent = wellCount;
                
                if (wellCount > 0) {
                    const avgSuccess = this.analysisHistory.reduce((sum, analysis) => 
                        sum + analysis.successRate, 0) / wellCount;
                    document.getElementById('aiSuccessRate').textContent = `${avgSuccess.toFixed(0)}%`;
                }
            }
            
            displayResults(result) {
                // Hide thinking process, show results
                document.getElementById('aiThinkingProcess').classList.add('hidden');
                document.getElementById('aiResults').classList.remove('hidden');
                
                // Update main success rate
                document.getElementById('aiSuccessRateResult').textContent = `${result.successRate.toFixed(1)}%`;
                
                // Animate success bar
                const successBar = document.getElementById('aiSuccessBar');
                successBar.style.width = '0%';
                setTimeout(() => {
                    successBar.style.width = `${result.successRate}%`;
                    successBar.className = `h-3 rounded-full transition-all duration-1500 ${
                        result.successRate < 40 ? 'bg-red-500' :
                        result.successRate < 60 ? 'bg-yellow-500' :
                        result.successRate < 80 ? 'bg-blue-500' : 'bg-green-500'
                    }`;
                }, 100);
                
                // Update economic data
                document.getElementById('aiEftResult').textContent = result.eft.toFixed(1);
                document.getElementById('aiCostEstimate').textContent = `$${result.costEstimate.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
                document.getElementById('aiCycleTime').textContent = `${result.cycleTime.toFixed(1)} days`;
                
                // Calculate and display daily rate
                const dailyRate = result.costEstimate / Math.max(1, result.cycleTime);
                document.getElementById('aiDailyRate').textContent = `$${dailyRate.toLocaleString(undefined, { maximumFractionDigits: 0 })}/day`;
                
                // Update viability score
                document.getElementById('aiViabilityScore').textContent = result.viabilityScore;
                const viabilityLabel = document.getElementById('aiViabilityLabel');
                viabilityLabel.textContent = result.viabilityScore >= 70 ? 'Excellent' :
                                          result.viabilityScore >= 50 ? 'Good' :
                                          result.viabilityScore >= 30 ? 'Fair' : 'Poor';
                viabilityLabel.className = `text-sm ${
                    result.viabilityScore >= 70 ? 'text-green-600 font-bold' :
                    result.viabilityScore >= 50 ? 'text-blue-600' :
                    result.viabilityScore >= 30 ? 'text-yellow-600' : 'text-red-600'
                }`;
                
                // Update verdict
                const verdict = document.getElementById('aiVerdict');
                if (result.successRate >= 70 && result.cycleTime < result.eft) {
                    verdict.textContent = 'GOOD TO GO';
                    verdict.className = 'px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-full text-sm font-bold';
                } else if (result.successRate >= 50 && result.cycleTime < result.eft * 1.2) {
                    verdict.textContent = 'GOOD TO GO';
                    verdict.className = 'px-4 py-2 bg-gradient-to-r from-yellow-600 to-yellow-700 text-white rounded-full text-sm font-bold';
                } else {
                    verdict.textContent = 'NO GO';
                    verdict.className = 'px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-full text-sm font-bold';
                }
                
                // Display recommendations
                const recommendationsList = document.getElementById('aiRecommendationsList');
                recommendationsList.innerHTML = result.recommendations.map(rec => `
                    <div class="${rec.bgColor} p-4 rounded-lg border">
                        <div class="flex items-start gap-3">
                            <i class="fas ${rec.icon} ${rec.color} text-lg mt-1"></i>
                            <div>
                                <div class="font-bold ${rec.color} mb-1">${rec.title}</div>
                                <div class="text-sm text-gray-700">${rec.message}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Display risks
                const riskAssessment = document.getElementById('aiRiskAssessment');
                if (result.risks.length > 0) {
                    riskAssessment.innerHTML = result.risks.map(risk => `
                        <div class="p-3 rounded-lg ${
                            risk.severity === 'critical' ? 'bg-red-50 border border-red-200' :
                            risk.severity === 'high' ? 'bg-orange-50 border border-orange-200' :
                            'bg-yellow-50 border border-yellow-200'
                        }">
                            <div class="flex items-start gap-2">
                                <i class="fas ${
                                    risk.severity === 'critical' ? 'exclamation-triangle' : 'exclamation-circle'
                                } ${
                                    risk.severity === 'critical' ? 'text-red-500' :
                                    risk.severity === 'high' ? 'text-orange-500' : 'text-yellow-500'
                                } mt-1"></i>
                                <div class="flex-1">
                                    <div class="font-medium ${
                                        risk.severity === 'critical' ? 'text-red-700' :
                                        risk.severity === 'high' ? 'text-orange-700' : 'text-yellow-700'
                                    }">${risk.message}</div>
                                    <div class="text-xs text-gray-600 mt-1">Mitigation: ${risk.mitigation}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    riskAssessment.innerHTML = `
                        <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                            <i class="fas fa-check-circle text-green-500 text-2xl mb-2"></i>
                            <div class="font-medium text-green-700">No Critical Risks Identified</div>
                            <div class="text-sm text-green-600 mt-1">All parameters within acceptable ranges</div>
                        </div>
                    `;
                }
                
                // Update confidence
                const confidencePercent = Math.round(result.confidence * 100);
                document.getElementById('aiConfidenceText').textContent = `${confidencePercent}%`;
                const confidenceBar = document.getElementById('aiConfidenceBar');
                confidenceBar.style.width = `${confidencePercent}%`;
                confidenceBar.className = `h-2 rounded-full ${
                    confidencePercent >= 80 ? 'bg-green-500' :
                    confidencePercent >= 60 ? 'bg-blue-500' :
                    confidencePercent >= 40 ? 'bg-yellow-500' : 'bg-red-500'
                }`;
                
                // Update EFT label
                const eftLabel = document.getElementById('aiEftLabel');
                if (result.cycleTime < result.eft) {
                    eftLabel.innerHTML = `<span class="text-green-600 font-bold">‚úì Within economic limit</span>`;
                } else {
                    const overrun = (result.cycleTime - result.eft).toFixed(1);
                    eftLabel.innerHTML = `<span class="text-red-600 font-bold">‚ö† Exceeds by ${overrun} days</span>`;
                }
            }
        }

        // =============================================
        // INITIALIZE MANAGERS
        // =============================================
        const historicalWellManager = new HistoricalWellManager();
        const hsseRiskCalculator = new HSSERiskCalculator();
        const enhancedAI = new EnhancedFishingAI();

        // =============================================
        // ORIGINAL CALCULATION FUNCTIONS (keep as is)
        // =============================================

        // Fish type data with all original calculations
        const fishTypeData = {
            'mechPacker10_3_4': { days: 4.000, dailyCost: 1679.85, successRate: 1.0, potentialRate: 0.100 },
            'mechPacker9_5_8': { days: 4.000, dailyCost: 4098.50, successRate: 0.75, potentialRate: 0.050 },
            'mechPacker7': { days: 3.000, dailyCost: 4221.33, successRate: 0.97, potentialRate: 0.030 },
            'cpa9_5_8': { days: 2.000, dailyCost: 2376.00, successRate: 1.0, potentialRate: 0.060 },
            'cpa7': { days: 2.500, dailyCost: 3000.00, successRate: 1.0, potentialRate: 0.045 },
            'tubingHanger': { days: 1.700, dailyCost: 1324.12, successRate: 1.0, potentialRate: 0.010 },
            'espTubing': { days: 6.000, dailyCost: 2332.00, successRate: 0.83, potentialRate: 0.000 },
            'pump': { days: 3.610, dailyCost: 2036.84, successRate: 0.92, potentialRate: 0.100 },
            'cibp': { days: 2.600, dailyCost: 3249.62, successRate: 0.81, potentialRate: 0.100 },
            'tubular': { days: 3.470, dailyCost: 1724.50, successRate: 0.90, potentialRate: 0.000 },
            'tubularCemented': { days: 11.000, dailyCost: 2204.82, successRate: 0.67, potentialRate: 0.200 },
            'drillingBHA': { days: 8.500, dailyCost: 2476.94, successRate: 0.63, potentialRate: 0.070 },
            'loggingTool': { days: 4.000, dailyCost: 393.75, successRate: 0.82, potentialRate: 0.060 },
            'liner4': { days: 4.500, dailyCost: 4304.89, successRate: 1.0, potentialRate: 0.050 },
            'liner5_1_2': { days: 4.500, dailyCost: 3504.67, successRate: 0.93, potentialRate: 0.090 },
            'liner6_5_8': { days: 4.500, dailyCost: 4071.33, successRate: 0.92, potentialRate: 0.150 },
            'casing': { days: 5.000, dailyCost: 1875.00, successRate: 1.0, potentialRate: 0.010 },
            'dc': { days: 2.000, dailyCost: 1379.39, successRate: 1.0, potentialRate: 0.000 },
            'bullplug': { days: 3.000, dailyCost: 1945.33, successRate: 0.85, potentialRate: 0.000 },
            'cone': { days: 5.000, dailyCost: 1321.40, successRate: 0.90, potentialRate: 0.000 },
            'sandBailer': { days: 3.000, dailyCost: 1007.22, successRate: 1.0, potentialRate: 0.000 },
            'sinkerBar': { days: 3.000, dailyCost: 1330.67, successRate: 1.0, potentialRate: 0.000 },
            'junks': { days: 2.700, dailyCost: 1118.89, successRate: 0.75, potentialRate: 0.030 }
        };

        function getFishTypeData(fishType) {
            return fishTypeData[fishType] || { days: 3.0, dailyCost: 1500.00, successRate: 0.80 };
        }

        function calculateSingleFishParameters(fishEntry) {
            const fishType = fishEntry.querySelector('.fish-type').value;
            const fieldNameSelect = document.getElementById('fieldName');
            const selectedField = fieldNameSelect.options[fieldNameSelect.selectedIndex];
            const rigCost = parseFloat(selectedField.getAttribute('data-rig-cost'));

            const fishData = getFishTypeData(fishType);
            const timeEstimate = fishData.days;
            const dailyTotalCost = fishData.dailyCost + rigCost;
            const costEstimate = dailyTotalCost * fishData.days;
            const successRate = fishData.successRate;

            return { timeEstimate, costEstimate, successRate };
        }

        function calculateFishingProbability() {
            const wellExTpa = parseFloat(document.getElementById('wellExTpa').value) || 0;
            const wellGeometry = parseFloat(document.getElementById('wellGeometry').value) || 0;
            const formationAbove = parseFloat(document.getElementById('formationAbove').value) || 0;
            const objectPeriod = parseFloat(document.getElementById('objectPeriod').value) || 0;
            const safetyJoint = parseFloat(document.getElementById('safetyJoint').value) || 0;
            const tailPresence = parseFloat(document.getElementById('tailPresence').value) || 0;

            const fieldName = document.getElementById('fieldName');
            const fieldComplexityProb = parseFloat(fieldName.options[fieldName.selectedIndex].getAttribute('data-complexity-prob')) || 0;

            const fishEntries = document.querySelectorAll('.fish-entry');
            let totalPotentialRate = 0;
            let count = 0;

            fishEntries.forEach(entry => {
                const fishType = entry.querySelector('.fish-type').value;
                const fishData = getFishTypeData(fishType);
                totalPotentialRate += fishData.potentialRate || 0;
                count++;
            });

            while (count < 3) {
                totalPotentialRate += 0.0;
                count++;
            }

            const avgPotentialRate = totalPotentialRate / 3;
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const casingPartedCollapseValue = document.getElementById('casingPartedCollapse').value;
            const casingDamageValue = document.getElementById('casingDamage').value;

            if (isFirstEntry) {
                if (casingPartedCollapseValue === '0' || casingDamageValue === '0') {
                    return 100.00;
                }
                if (casingPartedCollapseValue === '0.2' || casingDamageValue === '0.57') {
                    return 100.00;
                }
            }

            const totalProbability = wellExTpa + wellGeometry + formationAbove + objectPeriod + safetyJoint + tailPresence + fieldComplexityProb + avgPotentialRate;
            const result = Math.min(100, Math.max(0, totalProbability * 100));
            return result.toFixed(2);
        }

        function calculateAverageFishSuccessRate() {
            const fishEntries = document.querySelectorAll('.fish-entry');
            const fishRates = Array.from(fishEntries).map(entry => {
                const fishType = entry.querySelector('.fish-type').value;
                return getFishTypeData(fishType).successRate;
            });
            while (fishRates.length < 3) fishRates.push(1.0);
            const average = fishRates.reduce((sum, rate) => sum + rate, 0) / 3;
            return average;
        }

        function calculateFishingSuccessRate() {
            const casingPartedCollapse = parseFloat(document.getElementById('casingPartedCollapse').value);
            const casingDamage = parseFloat(document.getElementById('casingDamage').value);

            if (casingPartedCollapse === 0 || casingDamage === 0) {
                const notesContainer = document.getElementById('toolRecommendationNotes');
                notesContainer.innerHTML = `<div class="p-2 bg-red-100 border border-red-300 rounded text-red-800"><i class="fas fa-exclamation-triangle mr-2"></i>Fishing impossible - Neither tools nor fish can pass through casing</div>`;
                notesContainer.classList.remove('hidden');
                return 0;
            }

            try {
                const factors = {
                    casingPartedCollapse: parseFloat(document.getElementById('casingPartedCollapse').value) || 1,
                    casingDamage: parseFloat(document.getElementById('casingDamage').value) || 1,
                    fishingType: parseFloat(document.getElementById('fishingType').value) || 1,
                    wellGeometrySuccess: parseFloat(document.getElementById('wellGeometrySuccess').value) || 1,
                    tofCondition: parseFloat(document.getElementById('tofCondition').value) || 1,
                    fishDetailCondition: parseFloat(document.getElementById('fishDetailCondition').value) || 1,
                    fieldComplexitySuccess: parseFloat(document.querySelector('#fieldName option:checked')?.getAttribute('data-complexity-success')) || 1
                };

                const avgFishSuccess = calculateAverageFishSuccessRate();
                const successRate = factors.casingPartedCollapse * factors.casingDamage * factors.fishingType * factors.wellGeometrySuccess * avgFishSuccess * factors.fishDetailCondition * factors.tofCondition * factors.fieldComplexitySuccess;

                return successRate * 100;
            } catch (error) {
                console.error("Error calculating fishing success rate:", error);
                return 0;
            }
        }

        function getTotalTimeEstimate() {
            let total = 0;
            document.querySelectorAll('.fish-entry').forEach(entry => {
                const result = calculateSingleFishParameters(entry);
                total += result.timeEstimate;
            });
            return total;
        }

        function getTotalCostEstimate() {
            let total = 0;
            document.querySelectorAll('.fish-entry').forEach(entry => {
                const result = calculateSingleFishParameters(entry);
                total += result.costEstimate;
            });
            return total;
        }

        function getPreviousJobCost() {
            return parseFloat(document.getElementById('previousJobCost').value) || 0;
        }

        function getBOPD() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            if (isFirstEntry) {
                return parseFloat(document.getElementById('oilProductionFirst').value) || 0;
            } else {
                return parseFloat(document.getElementById('oilProduction').value) || 0;
            }
        }

        function getOilPrice() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            if (isFirstEntry) {
                return parseFloat(document.getElementById('oilPriceFirst').value) || 0;
            } else {
                return parseFloat(document.getElementById('oilPrice').value) || 0;
            }
        }

        function calculateNewNumerator() {
            const bopd = getBOPD();
            const oilPrice = getOilPrice();
            const cycleTimeEstimate = getTotalTimeEstimate();
            const previousJobCost = getPreviousJobCost();
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';

            const fieldNameSelect = document.getElementById('fieldName');
            const selectedField = fieldNameSelect.options[fieldNameSelect.selectedIndex];
            const annualDeclineRate = parseFloat(selectedField.getAttribute('data-decline-rate'));
            const monthlyDeclineRate = annualDeclineRate / 12;
            const liftingCost = parseFloat(selectedField.getAttribute('data-lifting-cost'));

            const currentFishingCost = getTotalCostEstimate();
            const totalFishingCost = currentFishingCost + previousJobCost;

            const monthlyProduction = [0];
            let currentProduction = bopd;

            for (let month = 1; month <= 12; month++) {
                currentProduction = currentProduction * (1 - monthlyDeclineRate);
                monthlyProduction.push(currentProduction);
            }

            const daysPerMonth = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            const monthlyRevenue = [0];

            for (let month = 1; month <= 12; month++) {
                const monthlyBarrels = monthlyProduction[month] * daysPerMonth[month];
                if (month === 1) {
                    monthlyRevenue.push(monthlyBarrels * (oilPrice - liftingCost));
                } else {
                    monthlyRevenue.push(monthlyBarrels * oilPrice);
                }
            }

            const cashFlow = [];
            
            if (isFirstEntry) {
                const fishingProbabilityValue = calculateFishingProbability();
                const probabilityValue = fishingProbabilityValue / 100;
                const fishingPotentialCost = currentFishingCost * probabilityValue;
                cashFlow.push(-fishingPotentialCost);
            } else {
                cashFlow.push(-totalFishingCost);
            }

            for (let month = 1; month <= 12; month++) {
                cashFlow.push(cashFlow[month - 1] + monthlyRevenue[month]);
            }

            const numerator = cashFlow[12] * annualDeclineRate;
            return numerator;
        }

        function calculateEFT(timeEstimate, costEstimate) {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            let successFactor;
            if (isFirstEntry) {
                successFactor = calculateFishingProbability() / 100;
            } else {
                successFactor = calculateFishingSuccessRate() / 100;
            }

            const previousJobCost = getPreviousJobCost();
            const totalFishingCost = costEstimate + previousJobCost;
            let fishingCost;
            if (isFirstEntry) {
                fishingCost = totalFishingCost * successFactor;
            } else {
                fishingCost = totalFishingCost;
            }

            const grossSplitNumerator = calculateNewNumerator();
            const eft = grossSplitNumerator / fishingCost;

            return eft;
        }

        function getCurrentWellData() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            return {
                wellName: document.getElementById('wellName').value,
                firstEntry: document.getElementById('firstEntry').value,
                oilProduction: document.getElementById('oilProduction').value || '0',
                oilPrice: document.getElementById('oilPrice').value || '0',
                previousJobCost: document.getElementById('previousJobCost').value || '0',
                oilProductionFirst: document.getElementById('oilProductionFirst').value || '0',
                oilPriceFirst: document.getElementById('oilPriceFirst').value || '0',
                fieldName: document.getElementById('fieldName').value,
                casingPartedCollapse: document.getElementById('casingPartedCollapse').value,
                casingDamage: document.getElementById('casingDamage').value,
                fishingType: document.getElementById('fishingType').value,
                wellGeometry: document.getElementById('wellGeometry').value || '0.01',
                wellGeometrySuccess: document.getElementById('wellGeometrySuccess').value || '1',
                formationAbove: document.getElementById('formationAbove').value,
                objectPeriod: document.getElementById('objectPeriod').value,
                safetyJoint: document.getElementById('safetyJoint').value,
                tailPresence: document.getElementById('tailPresence').value,
                wellExTpa: document.getElementById('wellExTpa').value,
                tofCondition: document.getElementById('tofCondition').value || '1',
                fishDetailCondition: document.getElementById('fishDetailCondition').value || '1',
                isFirstEntry: isFirstEntry
            };
        }

        // =============================================
        // NEW TAB FUNCTIONALITY
        // =============================================

        // Fishing Selection Guide functionality
        document.getElementById('guideRecommendBtn').addEventListener('click', function() {
            const fishType = document.getElementById('guideFishType').value;
            const wellCondition = document.getElementById('guideWellCondition').value;
            
            if (!fishType || !wellCondition) {
                alert('Please select both fish type and well condition');
                return;
            }
            
            const toolRecommendations = getToolRecommendations(fishType, wellCondition);
            displayToolRecommendations(toolRecommendations);
        });

        function getToolRecommendations(fishType, wellCondition) {
            const recommendations = {
                packer: {
                    open: ['Overshot with packer grapple', 'Hydraulic jar', 'Intensifier', 'Safety joint'],
                    cased: ['Overshot with packer grapple', 'Mechanical jar', 'Drill collars', 'Safety joint'],
                    damaged: ['Taper tap', 'Box tap', 'Heavy duty jar', 'Intensifier']
                },
                tubular: {
                    open: ['Overshot', 'Mechanical jar', 'Drill collars', 'Rotating safety joint'],
                    cased: ['Overshot or spear', 'Mechanical jar', 'Drill collars', 'Safety joint'],
                    damaged: ['Box tap', 'Taper tap', 'Heavy duty jar', 'Intensifier']
                },
                bha: {
                    open: ['Internal fishing tool', 'Junk basket', 'Mill', 'Heavy duty jar'],
                    cased: ['Internal fishing tool', 'Junk basket', 'Mill', 'Mechanical jar'],
                    damaged: ['Junk basket', 'Mill', 'Taper tap', 'Heavy duty jar']
                },
                junk: {
                    open: ['Junk basket', 'Magnet', 'Core barrel', 'Mill'],
                    cased: ['Junk basket', 'Magnet', 'Core barrel', 'Mill'],
                    damaged: ['Junk basket', 'Magnet', 'Mill', 'Taper tap']
                },
                liner: {
                    open: ['Overshot', 'Mechanical jar', 'Drill collars', 'Safety joint'],
                    cased: ['Overshot', 'Mechanical jar', 'Drill collars', 'Safety joint'],
                    damaged: ['Box tap', 'Taper tap', 'Heavy duty jar', 'Intensifier']
                },
                casing: {
                    open: ['Overshot', 'Heavy duty jar', 'Drill collars', 'Safety joint'],
                    cased: ['Overshot', 'Heavy duty jar', 'Drill collars', 'Safety joint'],
                    damaged: ['Taper tap', 'Box tap', 'Heavy duty jar', 'Intensifier']
                }
            };
            
            return recommendations[fishType]?.[wellCondition] || ['Standard fishing BHA', 'Mechanical jar', 'Drill collars', 'Safety joint'];
        }

        function displayToolRecommendations(tools) {
            const resultContainer = document.getElementById('toolRecommendationResult');
            const toolsList = document.getElementById('recommendedToolsList');
            
            toolsList.innerHTML = tools.map(tool => `
                <div class="flex items-center p-2 bg-white rounded border">
                    <i class="fas fa-check text-green-500 mr-2"></i>
                    <span>${tool}</span>
                </div>
            `).join('');
            
            resultContainer.classList.remove('hidden');
        }

        // BHA Design functionality
        let bhaComponents = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Make BHA components draggable
            const components = document.querySelectorAll('.bha-component');
            components.forEach(component => {
                component.addEventListener('dragstart', handleDragStart);
            });

            // Set up BHA assembly area
            const assemblyArea = document.getElementById('bha-assembly-area');
            assemblyArea.addEventListener('dragover', handleDragOver);
            assemblyArea.addEventListener('drop', handleDrop);

            // BHA template buttons
            document.getElementById('resetBhaBtn').addEventListener('click', resetBHA);
            document.getElementById('saveBhaBtn').addEventListener('click', saveBHA);
        });

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.getAttribute('data-component'));
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const componentType = e.dataTransfer.getData('text/plain');
            addComponentToBHA(componentType);
        }

        function addComponentToBHA(componentType) {
            bhaComponents.push(componentType);
            updateBHADisplay();
        }

        function updateBHADisplay() {
            const assemblyArea = document.getElementById('bha-assembly-area');
            
            if (bhaComponents.length === 0) {
                assemblyArea.innerHTML = `
                    <div class="text-center text-gray-500 py-16">
                        <i class="fas fa-arrow-down text-2xl mb-2"></i>
                        <p>Drag components here to build your BHA</p>
                    </div>
                `;
                return;
            }
            
            assemblyArea.innerHTML = `
                <div class="bha-diagram">
                    <div class="bha-part top">Kelly Cock</div>
                    ${bhaComponents.map(component => {
                        const componentNames = {
                            'fishing-tool': 'Fishing Tool',
                            'fishing-jar': 'Fishing Jar',
                            'accelerator': 'Accelerator',
                            'drill-collar': 'Drill Collar',
                            'stabilizer': 'Stabilizer',
                            'kelly-cock': 'Kelly Cock',
                            'jar-intensifier': 'Jar Intensifier'
                        };
                        return `
                            <div class="bha-connector"></div>
                            <div class="bha-part">${componentNames[component]}</div>
                        `;
                    }).join('')}
                    <div class="bha-connector"></div>
                    <div class="bha-part bottom">Bit/Bottom</div>
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>Total Components: ${bhaComponents.length}</p>
                    <p>BHA Length: ${bhaComponents.length * 30} ft (estimated)</p>
                </div>
            `;
        }

        function resetBHA() {
            bhaComponents = [];
            updateBHADisplay();
        }

        function saveBHA() {
            if (bhaComponents.length === 0) {
                alert('Please add components to your BHA before saving');
                return;
            }
            
            const bhaDesign = {
                components: bhaComponents,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('savedBHA', JSON.stringify(bhaDesign));
            alert('BHA design saved successfully!');
        }

        function loadBhaTemplate(templateType) {
            const templates = {
                'standard': ['fishing-tool', 'fishing-jar', 'drill-collar', 'drill-collar', 'kelly-cock'],
                'heavy-duty': ['fishing-tool', 'jar-intensifier', 'fishing-jar', 'accelerator', 'drill-collar', 'drill-collar', 'drill-collar', 'kelly-cock'],
                'junk-basket': ['fishing-tool', 'fishing-jar', 'stabilizer', 'drill-collar', 'kelly-cock']
            };
            
            bhaComponents = templates[templateType] || [];
            updateBHADisplay();
        }

        // BHA Based on Fish Type functionality
        document.querySelectorAll('.fish-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const fishType = this.getAttribute('data-fish-type');
                showBHAForFishType(fishType);
            });
        });

        function showBHAForFishType(fishType) {
            const resultContainer = document.getElementById('fish-bha-result');
            const bhaDiagram = document.getElementById('bha-diagram');
            const toolRecommendations = document.getElementById('tool-recommendations');
            const keyConsiderations = document.getElementById('key-considerations');
            
            const bhaData = getBHAForFishType(fishType);
            
            // Update BHA diagram
            bhaDiagram.innerHTML = `
                <div class="bha-diagram">
                    <div class="bha-part top">Kelly Cock</div>
                    ${bhaData.bha.map(component => `
                        <div class="bha-connector"></div>
                        <div class="bha-part">${component}</div>
                    `).join('')}
                    <div class="bha-connector"></div>
                    <div class="bha-part bottom">Bit/Bottom</div>
                </div>
            `;
            
            // Update tool recommendations
            toolRecommendations.innerHTML = bhaData.tools.map(tool => `
                <div class="flex items-center p-2 bg-blue-50 rounded border border-blue-200">
                    <i class="fas fa-toolbox text-blue-500 mr-2"></i>
                    <span>${tool}</span>
                </div>
            `).join('');
            
            // Update key considerations
            keyConsiderations.innerHTML = bhaData.considerations.map(consideration => `
                <p>‚Ä¢ ${consideration}</p>
            `).join('');
            
            resultContainer.classList.remove('hidden');
        }

        function getBHAForFishType(fishType) {
            const bhaConfigs = {
                packer: {
                    bha: ['Drill Pipe', 'Kelly Cock', 'Drill Collar', 'Drill Collar', 'Jar Intensifier', 'Fishing Jar', 'Overshot with Packer Grapple'],
                    tools: ['Overshot with packer grapple', 'Hydraulic jar', 'Intensifier', 'Safety joint'],
                    considerations: [
                        'Ensure grapple matches packer size and type',
                        'Use intensifier for maximum jarring impact',
                        'Have safety joint set appropriately for release if needed',
                        'Consider chemical cutters as backup option'
                    ]
                },
                tubular: {
                    bha: ['Drill Pipe', 'Kelly Cock', 'Drill Collar', 'Drill Collar', 'Mechanical Jar', 'Overshot or Spear'],
                    tools: ['Overshot or spear', 'Mechanical jar', 'Drill collars', 'Rotating safety joint'],
                    considerations: [
                        'Select overshot or spear based on fish condition',
                        'Ensure proper catch mechanism engagement',
                        'Use rotating safety joint if rotation is needed',
                        'Have milling tools available if fish top is damaged'
                    ]
                },
                bha: {
                    bha: ['Drill Pipe', 'Kelly Cock', 'Drill Collar', 'Drill Collar', 'Heavy Duty Jar', 'Junk Basket', 'Internal Fishing Tool'],
                    tools: ['Internal fishing tool', 'Junk basket', 'Mill', 'Heavy duty jar'],
                    considerations: [
                        'Use junk basket to collect smaller debris first',
                        'Internal fishing tools work best with BHA components',
                        'Have milling capability for damaged components',
                        'Consider magnetic tools for metallic junk'
                    ]
                },
                junk: {
                    bha: ['Drill Pipe', 'Kelly Cock', 'Stabilizer', 'Mill', 'Junk Basket', 'Magnet'],
                    tools: ['Junk basket', 'Magnet', 'Core barrel', 'Mill'],
                    considerations: [
                        'Start with magnetic tools for metallic junk',
                        'Use junk baskets for larger debris',
                        'Milling may be necessary for packed junk',
                        'Consider circulation to lift smaller particles'
                    ]
                }
            };
            
            return bhaConfigs[fishType] || bhaConfigs.tubular;
        }

        // Fishing Operation Guidance functionality
        document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateChecklistProgress);
        });

        function updateChecklistProgress() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const checked = document.querySelectorAll('.checklist-item input[type="checkbox"]:checked');
            const progress = (checked.length / checkboxes.length) * 100;
            
            document.getElementById('checklistProgress').textContent = `${Math.round(progress)}%`;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // =============================================
        // ORIGINAL APPLICATION FUNCTIONALITY
        // =============================================

        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tabId = btn.getAttribute('data-tab');
                if (tabId === 'economic') {
                    const firstEntry = document.getElementById('firstEntry');
                    const oilProduction = document.getElementById('oilProduction');
                    const oilPrice = document.getElementById('oilPrice');
                    const previousJobCost = document.getElementById('previousJobCost');
                    const oilProductionFirst = document.getElementById('oilProductionFirst');
                    const oilPriceFirst = document.getElementById('oilPriceFirst');

                    let isValid = true;
                    if (!firstEntry.value) {
                        firstEntry.classList.add('border-red-500');
                        isValid = false;
                    }
                    if (firstEntry.value === 'no') {
                        if (!oilProduction.value) { oilProduction.classList.add('border-red-500'); isValid = false; }
                        if (!oilPrice.value) { oilPrice.classList.add('border-red-500'); isValid = false; }
                        if (!previousJobCost.value) { previousJobCost.classList.add('border-red-500'); isValid = false; }
                    } else if (firstEntry.value === 'yes') {
                        if (!oilProductionFirst.value) { oilProductionFirst.classList.add('border-red-500'); isValid = false; }
                        if (!oilPriceFirst.value) { oilPriceFirst.classList.add('border-red-500'); isValid = false; }
                    }
                    if (!isValid) {
                        e.preventDefault();
                        alert('Please fill in all required fields (marked with *) before viewing results');
                        return;
                    }
                }

                document.querySelectorAll('.tab-btn').forEach(tabBtn => {
                    tabBtn.classList.remove('text-blue-800', 'border-b-2', 'border-blue-800');
                    tabBtn.classList.add('text-gray-500');
                });
                btn.classList.remove('text-gray-500');
                btn.classList.add('text-blue-800', 'border-b-2', 'border-blue-800');

                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Fish entry management
        const fishEntriesContainer = document.getElementById('fishEntriesContainer');
        const addFishBtn = document.getElementById('addFishBtn');

        // Modified addFishEntry function to work with both tabs
        function addFishEntry() {
            const fishEntries = document.querySelectorAll('.fish-entry');
            if (fishEntries.length >= 3) {
                alert('Maximum 3 fish entries allowed');
                return;
            }
            const fishNumber = fishEntries.length + 1;
            const fishId = `fish-${fishNumber}`;
            const fishEntry = document.createElement('div');
            fishEntry.className = 'fish-entry';
            fishEntry.id = fishId;
            fishEntry.innerHTML = `
                <button class="remove-fish-btn" data-fish-id="${fishId}"><i class="fas fa-times"></i></button>
                <h3 class="font-semibold text-blue-700 mb-3">Fish #${fishNumber}</h3>
                <div class="mb-4 bg-gray-50 p-3 rounded-lg">
                    <h4 class="font-medium text-sm mb-2 text-gray-700">Fish Type</h4>
                    <select class="fish-type w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="mechPacker10_3_4">10-3/4" Mechanical Packer</option>
                        <option value="mechPacker9_5_8">9-5/8" Mechanical Packer</option>
                        <option value="mechPacker7">7" Mechanical Packer</option>
                        <option value="cpa9_5_8">9-5/8" CPA Assembly</option>
                        <option value="cpa7">7" CPA Assembly</option>
                        <option value="tubingHanger">7" Tubing Hanger</option>
                        <option value="espTubing">ESP</option>
                        <option value="pump">Pump</option>
                        <option value="cibp">CIBP</option>
                        <option value="tubular">Tubular</option>
                        <option value="tubularCemented">Tubular Cemented</option>
                        <option value="drillingBHA">Drilling BHA</option>
                        <option value="loggingTool">Logging Tool</option>
                        <option value="liner4">4" Liner</option>
                        <option value="liner5_1_2">5-1/2" Liner</option>
                        <option value="liner6_5_8">6-5/8" Liner</option>
                        <option value="casing">Casing</option>
                        <option value="dc">DC</option>
                        <option value="bullplug">Bullplug</option>
                        <option value="cone">Cone</option>
                        <option value="sandBailer">Sand Bailer</option>
                        <option value="sinkerBar">Sinker Bar</option>
                        <option value="junks">Junks (others)</option>
                    </select>
                </div>
            `;
            fishEntriesContainer.appendChild(fishEntry);
            
            // Set default value
            const select = fishEntry.querySelector('.fish-type');
            select.value = 'tubular';
            
            // Add event listeners
            fishEntry.querySelector('.remove-fish-btn').addEventListener('click', function () {
                removeFishEntry(this.getAttribute('data-fish-id'));
            });
            
            select.addEventListener('change', function () {
                updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                recommendFishingTools();
                document.dispatchEvent(new CustomEvent('fishEntryUpdated'));
                historicalWellManager.updateAIDisplay();
            });
            
            // Trigger custom event
            document.dispatchEvent(new CustomEvent('fishEntryUpdated'));
            
            // Update AI display
            historicalWellManager.updateAIDisplay();
            
            // Trigger calculations
            updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
            recommendFishingTools();
        }

        addFishBtn.addEventListener('click', addFishEntry);

        // Modified removeFishEntry function to work with both tabs
        function removeFishEntry(fishId) {
            const fishEntry = document.getElementById(fishId);
            if (fishEntry) {
                fishEntry.remove();
                const fishEntries = document.querySelectorAll('.fish-entry');
                fishEntries.forEach((entry, index) => {
                    const newNumber = index + 1;
                    entry.id = `fish-${newNumber}`;
                    entry.querySelector('h3').textContent = `Fish #${newNumber}`;
                    entry.querySelector('.remove-fish-btn').setAttribute('data-fish-id', `fish-${newNumber}`);
                });
                updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                recommendFishingTools();
                
                // Trigger custom event
                document.dispatchEvent(new CustomEvent('fishEntryUpdated'));
                
                // Update AI display
                historicalWellManager.updateAIDisplay();
            }
        }

        // First Entry toggle functionality
        document.getElementById('firstEntry').addEventListener('change', function () {
            toggleFishingDisplay();
            toggleWellGeometryFields();
            toggleNonFirstEntryFields();
            toggleFirstEntryEconomicFields();
            toggleTOFSection();
            updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
        });

        function toggleNonFirstEntryFields() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const nonFirstEntryFields = document.getElementById('nonFirstEntryFields');
            if (isFirstEntry) {
                nonFirstEntryFields.classList.add('hidden');
            } else {
                nonFirstEntryFields.classList.remove('hidden');
            }
        }

        function toggleFirstEntryEconomicFields() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const firstEntryEconomicFields = document.getElementById('firstEntryEconomicFields');
            if (isFirstEntry) {
                firstEntryEconomicFields.classList.remove('hidden');
            } else {
                firstEntryEconomicFields.classList.add('hidden');
            }
        }

        function toggleTOFSection() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const fishingConditionsSection = document.getElementById('fishingConditionsSection');
            if (isFirstEntry) {
                fishingConditionsSection.classList.add('hidden');
            } else {
                fishingConditionsSection.classList.remove('hidden');
            }
        }

        function toggleWellGeometryFields() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const firstEntryGeometry = document.getElementById('wellGeometry').closest('.mb-4');
            const notFirstEntryGeometry = document.getElementById('wellGeometrySuccess').closest('.mb-4');
            if (isFirstEntry) {
                firstEntryGeometry.classList.remove('hidden');
                notFirstEntryGeometry.classList.add('hidden');
            } else {
                firstEntryGeometry.classList.add('hidden');
                notFirstEntryGeometry.classList.remove('hidden');
            }
        }

        function toggleFishingDisplay() {
            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const firstEntryFields = document.getElementById('firstEntryFields');
            const actualFishingFields = document.getElementById('actualFishingFields');
            const fishingTitle = document.getElementById('fishingTitle');
            if (isFirstEntry) {
                firstEntryFields.classList.remove('hidden');
                actualFishingFields.classList.add('hidden');
                fishingTitle.textContent = "Potential Fishing";
            } else {
                firstEntryFields.classList.add('hidden');
                actualFishingFields.classList.remove('hidden');
                fishingTitle.textContent = "Planned Fishing";
            }
        }

        // Calculate button functionality
        document.getElementById('calculateBtn').addEventListener('click', function (e) {
            const firstEntry = document.getElementById('firstEntry');
            const fishEntries = document.querySelectorAll('.fish-entry');

            let isValid = true;
            let errorMessage = 'Please fill in all required fields:';

            if (!firstEntry.value) {
                firstEntry.classList.add('border-red-500');
                errorMessage += '\n- First Entry selection';
                isValid = false;
            }

            if (fishEntries.length === 0) {
                errorMessage += '\n- At least one fish entry must be added';
                isValid = false;
            }

            if (!isValid) {
                e.preventDefault();
                alert(errorMessage);
                return false;
            } else {
                calculateAllFishParameters();
                document.querySelector('[data-tab="economic"]').click();
            }
        });

        function calculateAllFishParameters() {
            const fishEntries = document.querySelectorAll('.fish-entry');
            if (fishEntries.length === 0) {
                alert('Please add at least one fish entry before calculating.');
                return;
            }

            let totalTimeEstimate = 0;
            let totalCostEstimate = 0;

            fishEntries.forEach(fishEntry => {
                const result = calculateSingleFishParameters(fishEntry);
                if (result) {
                    totalTimeEstimate += result.timeEstimate;
                    totalCostEstimate += result.costEstimate;
                }
            });

            const fishingProbabilityValue = calculateFishingProbability();
            updateEconomicAnalysis(totalTimeEstimate, totalCostEstimate, fishingProbabilityValue);
            recommendFishingTools();
        }

        function updateEconomicAnalysis(totalTimeEstimate, totalCostEstimate, fishingProbabilityValue) {
            const wellName = document.getElementById('wellName').value || 'Unnamed Well';
            document.getElementById('wellNameResult').textContent = wellName;

            const isFirstEntry = document.getElementById('firstEntry').value === 'yes';
            const casingPartedCollapse = parseFloat(document.getElementById('casingPartedCollapse').value) || 1;
            const casingDamage = parseFloat(document.getElementById('casingDamage').value) || 1;

            const fishingImpossible = casingPartedCollapse === 0 || casingDamage === 0;
            let adjustedFishingProbability = parseFloat(fishingProbabilityValue);

            if (fishingImpossible && !isFirstEntry) {
                document.getElementById('successPrediction').textContent = "0.00%";
                document.getElementById('successRate').textContent = "0.00%";
                const costVsEftContainer = document.getElementById('costVsEftContainer');
                const costVsEftContainerFirst = document.getElementById('costVsEftContainerFirst');
                costVsEftContainer.className = "p-4 border rounded-lg no-go";
                costVsEftContainerFirst.className = "p-4 border rounded-lg no-go";
                document.getElementById('costVsEft').textContent = "NO GO - FISHING IMPOSSIBLE";
                document.getElementById('costVsEftFirst').textContent = "NO GO - FISHING IMPOSSIBLE";
                return;
            }

            if (isFirstEntry) {
                document.getElementById('successRate').textContent = adjustedFishingProbability.toFixed(2) + '%';
                const probabilityValue = adjustedFishingProbability / 100;
                const adjustedCost = totalCostEstimate * probabilityValue;
                const adjustedCycleTime = totalTimeEstimate * probabilityValue;

                document.getElementById('estimatedCost').textContent = `$${adjustedCost.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
                document.getElementById('cycleTime').textContent = `${adjustedCycleTime.toFixed(1)} days`;
                
                const bopd = parseFloat(document.getElementById('oilProductionFirst').value) || 0;
                const oilPrice = parseFloat(document.getElementById('oilPriceFirst').value) || 0;
                
                if (bopd > 0 && oilPrice > 0) {
                    const eft = calculateEFT(totalTimeEstimate, totalCostEstimate);
                    document.getElementById('economicFishingTimeFirst').textContent = `${eft.toFixed(1)} days`;
                    
                    const costVsEftContainer = document.getElementById('costVsEftContainerFirst');
                    const costVsEftElement = document.getElementById('costVsEftFirst');
                    
                    const casingPartedValue = document.getElementById('casingPartedCollapse').value;
                    const casingDamageValue = document.getElementById('casingDamage').value;
                    const problematicCasingOptions = ['0.2', '0.57', '0'];
                    
                    if (problematicCasingOptions.includes(casingPartedValue) || problematicCasingOptions.includes(casingDamageValue)) {
                        costVsEftContainer.className = "p-4 border rounded-lg no-go";
                        costVsEftElement.textContent = "NO GO";
                    } else {
                        if (adjustedCycleTime < eft) {
                            costVsEftContainer.className = "p-4 border rounded-lg good-to-go";
                            costVsEftElement.textContent = "GOOD TO GO";
                        } else {
                            costVsEftContainer.className = "p-4 border rounded-lg no-go";
                            costVsEftElement.textContent = "NO GO";
                        }
                    }
                }
            } else {
                const fishingSuccessRate = parseFloat(calculateFishingSuccessRate());
                const eft = calculateEFT(totalTimeEstimate, totalCostEstimate);
                const previousJobCost = getPreviousJobCost();

                document.getElementById('successPrediction').textContent = fishingSuccessRate.toFixed(2) + '%';
                document.getElementById('fishingCostEstimate').textContent = `$${totalCostEstimate.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
                document.getElementById('previousJobCostResult').textContent = `$${previousJobCost.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;
                document.getElementById('fishingCycleTime').textContent = `${totalTimeEstimate.toFixed(1)} days`;
                document.getElementById('economicFishingTime').textContent = `${eft.toFixed(1)} days`;

                const costVsEftContainer = document.getElementById('costVsEftContainer');
                const costVsEftElement = document.getElementById('costVsEft');
                const isGoodToGo = fishingSuccessRate >= 53.4 && totalTimeEstimate < eft;

                if (isGoodToGo) {
                    costVsEftContainer.className = "p-4 border rounded-lg good-to-go";
                    costVsEftElement.textContent = "GOOD TO GO";
                } else {
                    costVsEftContainer.className = "p-4 border rounded-lg no-go";
                    costVsEftElement.textContent = "NO GO";
                }
            }
        }

        // Fishing tool recommendation logic
        function recommendFishingTools() {
            const fishEntries = document.querySelectorAll('.fish-entry');
            if (fishEntries.length === 0) return;

            const bhaContainer = document.getElementById('bhaRecommendation');
            const notesContainer = document.getElementById('toolRecommendationNotes');
            bhaContainer.innerHTML = '';
            notesContainer.innerHTML = '';
            notesContainer.classList.add('hidden');

            let recommendations = [];
            let notes = [];

            const casingCondition = document.getElementById('casingPartedCollapse').value;
            const fishingType = document.getElementById('fishingType').value;
            const tofCondition = document.getElementById('tofCondition').value;
            const casingDamage = document.getElementById('casingDamage').value;

            fishEntries.forEach(entry => {
                const fishType = entry.querySelector('.fish-type').value;
                switch (fishType) {
                    case 'mechPacker10_3_4':
                    case 'mechPacker9_5_8':
                    case 'mechPacker7':
                    case 'cpa9_5_8':
                    case 'cpa7':
                    case 'tubingHanger':
                    case 'espTubing':
                    case 'tubular':
                    case 'tubularCemented':
                    case 'liner4':
                    case 'liner5_1_2':
                    case 'liner6_5_8':
                    case 'casing':
                        if (casingCondition === '0' || casingDamage === '0') {
                            recommendations.push('tapertap');
                            notes.push('Severely damaged fish or casing requires taper tap');
                        } else if (tofCondition === '0.8') {
                            recommendations.push('boxtap');
                            notes.push('Fish with damaged tops require box tap');
                        } else {
                            recommendations.push('overshot');
                            recommendations.push('spear');
                        }
                        break;
                    case 'pump':
                    case 'cibp':
                    case 'drillingBHA':
                    case 'loggingTool':
                    case 'dc':
                        recommendations.push('spear');
                        recommendations.push('boxtap');
                        notes.push('Internal fishing tools recommended for these components');
                        break;
                    case 'bullplug':
                    case 'cone':
                    case 'sandBailer':
                    case 'sinkerBar':
                    case 'junks':
                        recommendations.push('tapertap');
                        recommendations.push('boxtap');
                        notes.push('Junk fishing tools recommended for these items');
                        break;
                }
            });

            recommendations = [...new Set(recommendations)];
            notes = [...new Set(notes)];

            const toolData = {
                'overshot': { name: 'Overshot', description: 'Best for tubular fish with clean outer surfaces', image: 'https://raw.githubusercontent.com/fadelgifari/focus/main/Images/Overshot.png', conditions: ['Clean fish exterior', 'Undamaged casing', 'Good TOF condition'] },
                'spear': { name: 'Spear', description: 'Ideal for internal fishing of pipes and packers', image: 'https://raw.githubusercontent.com/fadelgifari/focus/main/Images/Spear.png', conditions: ['Internal fishing', 'Accessible fish bore'] },
                'boxtap': { name: 'Box Tap', description: 'Used for damaged or irregular top fish profiles', image: 'https://raw.githubusercontent.com/fadelgifari/focus/main/Images/Box%20taps.png', conditions: ['Damaged fish top', 'Condition 2 or 3 TOF'] },
                'tapertap': { name: 'Taper Tap', description: 'For severely damaged fish tops or junk', image: 'https://raw.githubusercontent.com/fadelgifari/focus/main/Images/Taper%20tap.png', conditions: ['Severe damage', 'Junk fishing', 'Casing issues'] }
            };

            if (recommendations.length === 0) {
                bhaContainer.innerHTML = '<p class="text-gray-500">No specific recommendations based on current parameters</p>';
                return;
            }

            recommendations.forEach(toolKey => {
                const tool = toolData[toolKey];
                const toolDiv = document.createElement('div');
                toolDiv.className = 'text-center p-4 border rounded-lg bg-blue-50 tool-highlight';
                toolDiv.innerHTML = `
                    <div class="h-24 flex items-center justify-center mb-2">
                        <img src="${tool.image}" alt="${tool.name}" class="max-h-full max-w-full object-contain">
                    </div>
                    <h4 class="font-medium">${tool.name}</h4>
                    <p class="text-sm text-gray-600">${tool.description}</p>
                    <div class="mt-2 text-xs text-gray-500">
                        <p class="font-semibold">Recommended when:</p>
                        <ul class="list-disc list-inside text-left">${tool.conditions.map(c => `<li>${c}</li>`).join('')}</ul>
                    </div>
                `;
                bhaContainer.appendChild(toolDiv);
            });

            if (notes.length > 0) {
                notesContainer.innerHTML = `
                    <h4 class="font-semibold mb-2">Recommendation Notes:</h4>
                    <ul class="list-disc list-inside pl-4">${notes.map(n => `<li>${n}</li>`).join('')}</ul>
                `;
                notesContainer.classList.remove('hidden');
            }
        }

        // =============================================
        // UTILITY FUNCTIONS
        // =============================================
        function generateAIReport() {
            const wellData = getCurrentWellData();
            const history = enhancedAI.analysisHistory;
            
            if (history.length === 0) return 'No analysis data available';
            
            const result = history[history.length - 1];
            
            return `
FISHING EXPERT AI ANALYSIS REPORT
===================================

Well Information:
-----------------
Well Name: ${wellData.wellName || 'Unnamed Well'}
Field: ${wellData.fieldName || 'Not specified'}
Analysis Date: ${new Date().toLocaleString()}
Entry Type: ${wellData.isFirstEntry ? 'First Entry' : 'Subsequent Entry'}

AI Analysis Results:
--------------------
Success Probability: ${result.successRate.toFixed(1)}%
Economic Fishing Time (EFT): ${result.eft.toFixed(1)} days
Estimated Cycle Time: ${result.cycleTime.toFixed(1)} days
Estimated Cost: $${result.costEstimate.toLocaleString()}
Viability Score: ${result.viabilityScore}/100

Expert Verdict: ${result.cycleTime < result.eft ? 'ECONOMICALLY VIABLE' : 'ECONOMIC CONCERN'}

Technical Assessment:
---------------------
Casing Integrity Score: ${result.casingScore}/100
Fish Accessibility Score: ${result.accessScore}/100
AI Confidence Level: ${Math.round(result.confidence * 100)}%

Critical Factors:
-----------------
${result.risks.length > 0 ? result.risks.map(r => `- ${r.message}`).join('\n') : 'No critical risks identified'}

Recommendations:
---------------
${result.recommendations.map(r => `- ${r.message}`).join('\n')}

===================================
Report Generated by F.O.C.U.S AI Expert System
Confidence Level: ${Math.round(result.confidence * 100)}%
===================================
`;
        }

        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // =============================================
        // LOGIN/LOGOUT FUNCTIONALITY
        // =============================================
        const loginForm = document.getElementById('loginForm');
        const loginPage = document.getElementById('loginPage');
        const appContent = document.getElementById('appContent');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginError = document.getElementById('loginError');

        const validCredentials = {
            username: "nasir.nathan@pertamina.com",
            password: "prototype726"
        };

        loginForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === validCredentials.username && password === validCredentials.password) {
                loginPage.classList.add('hidden');
                appContent.classList.remove('hidden');
                loginError.classList.add('hidden');
                addFishEntry();
                toggleFishingDisplay();
                toggleFirstEntryEconomicFields();
                toggleTOFSection();
                sessionStorage.setItem('isLoggedIn', 'true');
            } else {
                loginError.classList.remove('hidden');
            }
        });

        logoutBtn.addEventListener('click', function () {
            sessionStorage.removeItem('isLoggedIn');
            loginPage.classList.remove('hidden');
            appContent.classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            loginError.classList.add('hidden');
        });

        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            loginPage.classList.add('hidden');
            appContent.classList.remove('hidden');
            addFishEntry();
            toggleFishingDisplay();
            toggleFirstEntryEconomicFields();
            toggleTOFSection();
        }

        // =============================================
        // INITIALIZE EVENT LISTENERS
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Save Well Data Button in Fill in Data tab
            document.getElementById('saveWellDataBtn').addEventListener('click', function() {
                if (historicalWellManager.saveCurrentWell()) {
                    alert('Well data saved successfully! You can now load it from the AI tab.');
                }
            });

            // Historical Well Manager
            document.getElementById('saveCurrentWellBtn').addEventListener('click', function() {
                if (historicalWellManager.saveCurrentWell()) {
                    alert('Well data saved to historical database!');
                }
            });

            // AI Fish Management - Updated to use new method
            document.getElementById('addFishAIBtn').addEventListener('click', function() {
                historicalWellManager.addFishEntryInAITab();
            });

            // Update AI display when fish entries change in main form
            document.addEventListener('fishEntryUpdated', function() {
                historicalWellManager.updateAIDisplay();
            });

            // HSSE Risk Calculator
            document.getElementById('calculateRiskBtn').addEventListener('click', function() {
                hsseRiskCalculator.calculateRisk();
            });
            
            // Overpull Risk Calculator
            document.getElementById('calculateOverpullBtn').addEventListener('click', function() {
                hsseRiskCalculator.calculateOverpullRisk();
            });

            // Enhanced AI event listeners
            document.getElementById('runAiAnalysis').addEventListener('click', async function() {
                try {
                    await enhancedAI.analyzeCurrentWell();
                } catch (error) {
                    alert(`AI Analysis Error: ${error.message}`);
                }
            });
            
            document.getElementById('saveAiReport').addEventListener('click', function() {
                const wellName = document.getElementById('wellName').value || 'Unnamed_Well';
                const timestamp = new Date().toISOString().split('T')[0];
                const filename = `AI_Fishing_Report_${wellName}_${timestamp}.txt`;
                
                const report = generateAIReport();
                downloadFile(filename, report);
                
                alert('AI Report exported successfully!');
            });
            
            // Initialize AI stats
            historicalWellManager.updateAIStats();
            enhancedAI.updateStats();

            // Sync fish age when object period changes
            document.getElementById('objectPeriod').addEventListener('change', syncFishAgeFromMainForm);
            
            // Initial sync
            syncFishAgeFromMainForm();

            // Original input listeners
            const inputsToWatch = [
                'casingPartedCollapse', 'casingDamage', 'fishingType',
                'wellGeometrySuccess', 'tofCondition', 'fishDetailCondition',
                'fieldName', 'oilProduction', 'oilPrice', 'previousJobCost',
                'oilProductionFirst', 'oilPriceFirst'
            ];

            inputsToWatch.forEach(id => {
                document.getElementById(id).addEventListener('change', function () {
                    updateEconomicAnalysis(getTotalTimeEstimate(), getTotalCostEstimate(), calculateFishingProbability());
                    recommendFishingTools();
                });
            });

            recommendFishingTools();
            
            // Initialize AI display
            setTimeout(() => {
                historicalWellManager.updateAIDisplay();
            }, 1000);
        });
    </script>
</body>
</html>


